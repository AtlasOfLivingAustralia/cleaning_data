% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod,
  oneside]{scrreprt}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[left=1in,marginparwidth=2.0666666666667in,textwidth=4.1333333333333in,marginparsep=0.3in]{geometry}
\usepackage{soul}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

\KOMAoption{captions}{tableheading}
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{bookmark}{}{\usepackage{bookmark}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[skins,breakable]{tcolorbox}}
\makeatother
\makeatletter
\@ifundefined{shadecolor}{\definecolor{shadecolor}{rgb}{.97, .97, .97}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{sidenotes}{}{\usepackage{sidenotes}}
\@ifpackageloaded{marginnote}{}{\usepackage{marginnote}}
\makeatother
\makeatletter
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={ALA Data Cleaning},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{ALA Data Cleaning}
\author{}
\date{}

\begin{document}
\maketitle
\ifdefined\Shaded\renewenvironment{Shaded}{\begin{tcolorbox}[enhanced, breakable, frame hidden, boxrule=0pt, sharp corners, borderline west={3pt}{0pt}{shadecolor}, interior hidden]}{\end{tcolorbox}}\fi

\renewcommand*\contentsname{Table of contents}
{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}
\bookmarksetup{startatroot}

\hypertarget{welcome}{%
\chapter*{Welcome}\label{welcome}}
\addcontentsline{toc}{chapter}{Welcome}

\markboth{Welcome}{Welcome}

Data cleaning is the exploration, detection and correction of erroneous
data. The standard of what `clean' data looks like varies considerably
across projects and data sources. This means that there is no
`one-size-fits-all' approach.

Our goal in creating this resource was to assist researchers and
decision makers that may have limited experience with cleaning
geo-referenced biodiversity data in R.

In this book, we provide an overview of a typical data cleaning workflow
- from acquisition, to identifying potential errors to correction.
Throughout each chapter, we include practical guidelines, R code blocks
and additional resources that may aid with each data cleaning step.

The content of this book is guided by the current state of biodiversity
literature on preparing data for species distribution modelling. For
more details about how this was done, please refer to the
\protect\hyperlink{sec-appendix}{Appendix}. All resources that have been
consulted for this book can be found in
\protect\hyperlink{sec-references}{References}.

\hypertarget{how-to-contribute}{%
\section*{How to contribute}\label{how-to-contribute}}
\addcontentsline{toc}{section}{How to contribute}

\markright{How to contribute}

We would like to preface that we are not experts in data cleaning, but
felt there was need for a consolidated resource to guide data cleaning
decisions.

We welcome contributions to this document and suggest folks to submit
pull requests at the
\href{https://github.com/AtlasOfLivingAustralia/cleaning_data}{GitHub
repository} of this document. Contributing guidelines can be found at XX
(Maybe another section or just a MD in GitHub Repo)

Alternatively, if you have questions please submit a
\href{https://github.com/AtlasOfLivingAustralia/cleaning_data/issues}{GitHub
issue}.

\hypertarget{how-to-cite}{%
\section*{How to cite}\label{how-to-cite}}
\addcontentsline{toc}{section}{How to cite}

\markright{How to cite}

TO COME BACK TO THIS LATER Refer to this when creating this
section(https://ardc.edu.au/resource/citing-software/)

You can cite this document:

\hypertarget{acknowlodgements}{%
\section*{Acknowlodgements}\label{acknowlodgements}}
\addcontentsline{toc}{section}{Acknowlodgements}

\markright{Acknowlodgements}

This book was inspired by an \href{https://ardc.edu.au/}{Australian
Research Data Commons} project where our team worked closely with
research partners to streamline their data cleaning workflows. This book
is a collaborative effort from the Science and Decision Support team at
the \href{https://www.ala.org.au/}{Atlas of Living Australia (ALA)}

Authors listed in alphabetic order:\\
- Fonti Kar\\
- Jessica Fenker\\
- Margot Schneider\\
- Martin Westgate

\bookmarksetup{startatroot}

\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

\begin{quote}
``Garbage in, garbage out'' - George Fuechsel, IBM computer programmer
\end{quote}

The idea that using flawed or nonsensical data as input produces output
of similar quality is one that is well known in many scientific
disciplines. In ecology and biodiversity research, however, scientists
are often at risk of unintentionally using flawed or nonsensical data
because they must bring together lots of data from many sources to
address their research questions. These data are rarely easy to combine.
Data from different sources vary widely in their structure and quality.
As a result, collating them into something usable to answer a research
question can be challenging.

\textbf{Data cleaning}, the process of identifying and fixing incorrect
or doubtful data, is an essential step in ecology and biodiversity
research. Data cleaning improves data quality and the validity of
scientific findings (Rodrigues et al. 2022).

This book will guide you through how to acquire and clean open access
biodiversity data in R. We will be working with point-based species
occurrence data from online infrastructures such as
\href{https://www.gbif.org/}{Global Biodiversity Information Facility}
(GBIF) and the \href{https://www.ala.org.au/}{Atlas of Living Australia}
(ALA). We will be working with the R package
\href{https://galah.ala.org.au/}{\texttt{galah}} for accessing
biodiversity data. If you have occurrence data you have personally
collected, some parts of this book may still be relevant.

We have included code blocks throughout this block to show you how to
execute a particular task. We will point out at the beginning of the
code block of any R packages that are needed for data cleaning or
visualising.

\hypertarget{what-you-will-learn-outline-of-the-book}{%
\section{What you will learn / Outline of the
book}\label{what-you-will-learn-outline-of-the-book}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# new diagram here}
\FunctionTok{library}\NormalTok{(DiagrammeR)}
\end{Highlighting}
\end{Shaded}

To begin working with open access data we'll teach you how to:

\begin{itemize}
\item
  Narrow your data scope
\item
  Import data
\item
  Tidy and familiarise yourself with meta-data
\end{itemize}

Once data have been imported and formatted correctly we'll dive into the
major cleaning steps. We will focus on how to deal with taxonomic and
spatial issues with biodiversity data.

\begin{itemize}
\tightlist
\item
  We will start with taxonomic issues

  \begin{itemize}
  \tightlist
  \item
    Taxonomic issues

    \begin{itemize}
    \tightlist
    \item
      naming authorities
    \item
      synonyms
    \item
      Duplicates
    \end{itemize}
  \item
    Spatial data

    \begin{itemize}
    \tightlist
    \item
      Outliers
    \item
      Duplicates
    \end{itemize}
  \end{itemize}
\end{itemize}

\hypertarget{what-you-wont-learn}{%
\section{What you won't learn}\label{what-you-wont-learn}}

There are many important subject areas that this book will not cover. We
won't be teaching you:

\begin{itemize}
\tightlist
\item
  How to clean other data types e.g.~environmental or trait data
\item
  How to run a species distribution model
\item
  Hypothesis testing or experimental design
\end{itemize}

\hypertarget{prerequisites}{%
\section{Prerequisites}\label{prerequisites}}

\hypertarget{user-accounts}{%
\subsection{User accounts}\label{user-accounts}}

To get data out of data infrastructures such as the Atlas of living
Australia (ALA) or the Global Biodiversity Information (GBIF) you'll
need to first create an account. You'll want to sign up for an account
with the relevant data infrastructre, this book will use ALA and GBIF
data as examples.

Atlas of Living Australia =
\href{https://auth.ala.org.au/userdetails/registration/createAccount}{create
an account} Global Biodiversity Information Facility =
\href{https://www.gbif.org/user/profile}{create an account}

\hypertarget{r}{%
\subsection{R}\label{r}}

Download R from \href{https://cloud.r-project.org/}{CRAN} (the
comprehensive R archive network), for your operating system, and install
it on your device. Major updates for R come out yearly with a few minor
releases throughout the year, so make sure to update semi regularly.

\hypertarget{windows}{%
\subsubsection*{Windows}\label{windows}}
\addcontentsline{toc}{subsubsection}{Windows}

\hypertarget{mac}{%
\subsubsection*{Mac}\label{mac}}
\addcontentsline{toc}{subsubsection}{Mac}

\hypertarget{rstudio}{%
\subsection{RStudio}\label{rstudio}}

Rstudio is an integrated development environment (IDE) for R
programming. Download and install Rstudio for your operating system
\url{https://posit.co/download/rstudio-desktop/}

\hypertarget{windows-1}{%
\subsubsection*{Windows}\label{windows-1}}
\addcontentsline{toc}{subsubsection}{Windows}

\hypertarget{mac-1}{%
\subsubsection*{Mac}\label{mac-1}}
\addcontentsline{toc}{subsubsection}{Mac}

\hypertarget{how-to-use-this-book}{%
\section{How to use this book}\label{how-to-use-this-book}}

There is no one size fits all workflow, not all steps are relevant
and/or possible. Through examining the literature we found steps were
frequently done in completely different orders depending on the nature
of the study and the area of expertise possessed. Because of this, we
don't recommend you use this book in a linear fashion. However some
steps logically come first, you might need to go back to them after
completely another (fig x)
\includegraphics{images/data.cleaning-Page-2.drawio.png}

\bookmarksetup{startatroot}

\hypertarget{data-scope}{%
\chapter{Data scope}\label{data-scope}}

Data scope pertains to the type of data needed for your project, your
research question will help guide the scope of data you need.

Consider the following to in reference to your research aim:

\begin{itemize}
\tightlist
\item
  What is the \textbf{taxonomic} unit of your research interest?
\item
  What is the \textbf{spatial} scale of your project? The entire
  country? A specific conservation area?
\end{itemize}

Your data scope may change according to the availability of data for
certain research interests. In some instances, rare species tend to have
considerably fewer records.

\hypertarget{taxonomic-scope}{%
\section{Taxonomic scope}\label{taxonomic-scope}}

Where the aim of the study is to gather data on a specific taxonomic
unit. This could be a threatened species or a broad taxonomic group. The
download query is performed using the scientific name or name of the
taxonomic group.

\includegraphics{scope_files/figure-pdf/unnamed-chunk-1-1.pdf}

\marginnote{\begin{footnotesize}

Curious what \emph{Lampromicra senator} looks like?

\begin{figure}

{\centering 

\href{https://images.ala.org.au/store/4/8/8/4/1f4fc763-d21f-4e5d-b803-f931a4c14884/tms/3/2/1.png}{\includegraphics[width=8.33333in,height=\textheight]{images/Lampromicra.jpeg}}

}

\caption{Lampromicra senator perched on a leaf by Dexmond Wells CC-BY-NC
4.0}

\end{figure}

\end{footnotesize}}

\hypertarget{spatial-scope}{%
\section{Spatial scope}\label{spatial-scope}}

Where the aim is to obtain data for targeted taxa in a given location.
In this case, the region name or area boundaries can be used to delimit
the area of interest. The example below shows all Insecta orders in the
state of Tasmania in Australia

\includegraphics{scope_files/figure-pdf/unnamed-chunk-2-1.pdf}

\hypertarget{naming-authorities}{%
\section{Naming authorities}\label{naming-authorities}}

\hypertarget{choosing-your-own-naming-authority}{%
\subsection{Choosing your own naming
authority}\label{choosing-your-own-naming-authority}}

Using a naming authority is a great way to make decisions surrounding
taxonomic categorizations of open source biodiversity data. However,
deciding what naming authority to use can be challenging and time
consuming.

What naming authority you choose will most certainly depend on your data
scope. Spatial focus, will have many species and may need multiple
naming authorities.

A knowledge of taxonomy assist your ability to verify the data you are
working with. For this, different organizations provide updated lists of
species or even details of the taxonomic history of a species.

Checking changes in taxonomy can be helpful when interpreting old data
which may have species names you don't recognize.

Changes in taxonomy, such as species split, new higher level
classification (as genera), or species descriptions, highlight the
importance of keeping up-to-date with taxonomic literature. This can be
achieved by consulting the literature. Most taxonomic society groups
release annual updates on taxonomy.

In Australia, the \href{https://www.anbg.gov.au/apni/}{Australian Plant
Name Index (APNI)} is the primary naming authority for plants. With the
\href{https://biodiversity.org.au/afd/home}{Australian Faunal Directory
(AFD)} the main taxonomic catalog for animal species. These authorities
provide a list of accepted and authoritative names as a template. If
you're unsure what naming authority to use and you're looking at
Australian species, the APNI and the AFD are a good place to start,
especially if the data you're investigating covers a wide range of taxa.
If you're investigating specific taxa it's worth checking when the
taxonomy was last updated in the APNI or AFD, especially if you know
there has been recent changes. If you want to investigate closer, we've
provided some links to society groups, in some cases these can be more
up to date that the APNI or AFD.

\hypertarget{naming-authorities-1}{%
\section{Naming authorities}\label{naming-authorities-1}}

Accurate species delimitation is crucial for adequate conservation
management and understanding evolutionary processes (Mace 2004).
Species-level lists are the foundation of conservation decisions, such
as is the IUCN Red List (\textbf{melville21?}).

The difference in scope might influence if you choose to use a naming
authority from a taxonomic society group or multiple broad sources.

\hypertarget{naming-authorities-and-taxonomy-in-biodiversity-databases}{%
\section{Naming authorities and taxonomy in biodiversity
databases}\label{naming-authorities-and-taxonomy-in-biodiversity-databases}}

When you download data from different databases you might be faced with
inconsistencies between the datasets. This is a challenge that data
aggregators face when ingesting and aggregating data. This is a large
task with lots of heterogeneity and can lead to errors along the way. To
help deal with naming inconsistencies, naming authorities are used by
online biodiversity databases in order to classify species {[}REF{]}.
Different databases might use different naming authorities, and you
might not agree with their classifications. There may be other issues
you are not aware of: For example, the ALA uses multiple naming
authorities in a hierarchical format:

(note image is from a helpfile I wrote- we can re-do it so it's
consistent with the style of this document)

\includegraphics{images/image-1066364510.png}

With all that, open source data has many pros, so how does one deal with
taxonomic inconsistencies to get the most accurate data in the end?

While this is in theory how the ALAs backbone is built, issues can occur
with aggregation leading to potentially serious problems with the
taxonomic structure. In addition data can be parsed incorrectly, and the
process isn't transparent. Meaning that when the taxonomic backbone is
updated, the elements that have changed are untraceable. These issues
are not specific to ALA taxonomy, but occur in varying forms among data
aggregators.

\bookmarksetup{startatroot}

\hypertarget{sec-download-data}{%
\chapter{Download occurrence data}\label{sec-download-data}}

Once you have decided on your data scope, we can precede to downloading
the data. We will introduce a few common data infrastructures that offer
open access biodiversity data and highlight some considerations when
choosing one in the context of your data scope. We will then discuss
some obstacles when consolidating data from multiple sources and the
importance of metadata.

\hypertarget{where-to-get-data-from}{%
\section{Where to get data from}\label{where-to-get-data-from}}

The \href{https://www.gbif.org/}{Global Biodiversity Information
Facility (GBIF)} network consists of a series of `node' organisations
who collate biodiversity data from their own countries, with GBIF acting
as an overarching organisation to store data from all nodes. Users that
are interested in obtaining data that has global coverage may want to
download directly from GBIF.

Alternatively, using a \emph{regional node} may be more relevant if your
project is at a smaller scale. For example, the
\href{www.ala.org.au}{Atlas of Living Australia (ALA)} is the Australian
node to GBIF and aggregates data from a broad range of providers such as
government initiatives, museums, and universities. Importantly, the ALA
uses their own taxonomic system and may vary with other data
infrastructures. To find other nodes, check out this
\href{https://www.gbif.org/the-gbif-network}{page}

If your project relates to citizen science then
\href{https://www.inaturalist.org/}{iNaturalist} may be a good option
for accessing crowd-sourced data of species observations.

\hypertarget{downloading-data}{%
\section{Downloading data}\label{downloading-data}}

\hypertarget{taxonomic-focus}{%
\subsection{Taxonomic focus}\label{taxonomic-focus}}

\hypertarget{query-with-choosen-naming-authority}{%
\section{Query with choosen naming
authority}\label{query-with-choosen-naming-authority}}

(May go before download data or used after download to refine, improve
download)

Now that you've chosen a naming authority you can use it to ensure
consistency across your data set, but also check you haven't missed any
species data from your download.

\hypertarget{getting-higher-taxonomy}{%
\subsection{Getting higher taxonomy}\label{getting-higher-taxonomy}}

Downloading higher taxon data (kingdom:class) and then filtering for
what you need, as disparities are less common at higher levels (????
Check with Martin)

\hypertarget{getting-all-taxonomy-relevant-columns}{%
\subsection{Getting all taxonomy relevant
columns}\label{getting-all-taxonomy-relevant-columns}}

Include the original name that was recorded by the data provider in your
download. This is often referred to as \texttt{verbatimScientificName}.
or vernacularname

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Include synonyms of the species names you're interested in your
  download
\end{enumerate}

Many developers have created R packages to interact with each data
infrastructures's API to aid access to biodiversity data. Here are a few
examples, we recommend taking a look at each package's documentation to
choose one that suits your project.

\begin{itemize}
\tightlist
\item
  \href{https://docs.ropensci.org/rgbif/}{\texttt{rgbif}} an interface
  to GBIF
\item
  \href{https://galah.ala.org.au/index.html}{\texttt{galah}} an
  interface to a number living Atlases, as well as GBIF
\item
  \href{https://docs.ropensci.org/rinat/}{\texttt{rinat}} an interface
  to iNaturalist observations
\item
  \href{https://docs.ropensci.org/rebird/}{\texttt{rebird}} an interface
  with the eBird webservices.
\item
  \href{https://docs.ropensci.org/spocc/}{\texttt{spocc}} a R package to
  query and collect species occurrence data from various sources
  including \href{https://github.com/ropensci/rvertnet}{VertNet},
  \href{http://www.idigbio.org/}{iDigBio} and others.
\end{itemize}

One benefit of using \texttt{galah} is that enables users to acquire not
only species occurrence records but also taxonomic information, or
associated media such as images or sounds. Below we have included some
code blocks for downloading occurrence data with \texttt{galah} from
GBIF and a Spain node.

\hypertarget{gbif-data-via-galah}{%
\subsubsection{\texorpdfstring{GBIF data via
\texttt{galah}}{GBIF data via galah}}\label{gbif-data-via-galah}}

First, we have to configure \texttt{galah}. This is where you supply
your account credentials and set the atlas to a particular region. See
\texttt{?galah\_config} for more configuration options. You can
\href{https://docs.ropensci.org/rgbif/articles/gbif_credentials.html}{save
these credentials} in your \texttt{.Renviron} so you don't have to enter
it explicitly in code.

We will be downloading all occurrences for the African Elephant from
GBIF. This may take a while as it is around 12,000 records. Once
downloaded, you can save the records locally in your desired format. For
larger downloads, we recommend saving the data as \texttt{parquets}
using \texttt{arrow::write\_parquet}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{galah\_config}\NormalTok{(}\AttributeTok{email =} \FunctionTok{Sys.getenv}\NormalTok{(}\StringTok{"ALA\_EMAIL"}\NormalTok{),}
             \AttributeTok{username =} \FunctionTok{Sys.getenv}\NormalTok{(}\StringTok{"GBIF\_USER"}\NormalTok{),}
             \AttributeTok{password =} \FunctionTok{Sys.getenv}\NormalTok{(}\StringTok{"GBIF\_PWD"}\NormalTok{),}
             \AttributeTok{atlas =} \StringTok{"Global"}\NormalTok{)}

\NormalTok{african\_ele }\OtherTok{\textless{}{-}} \FunctionTok{galah\_call}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{galah\_identify}\NormalTok{(}\StringTok{"Loxodonta africana"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{atlas\_occurrences}\NormalTok{()}

\NormalTok{arrow}\SpecialCharTok{::}\FunctionTok{write\_parquet}\NormalTok{(african\_ele, }\StringTok{"data/gbif/elephant"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 12,537 x 50
      gbifID datasetKey     occurrenceID kingdom phylum class order family genus
 *     <dbl> <chr>          <chr>        <chr>   <chr>  <chr> <chr> <chr>  <chr>
 1 924537719 95f132fe-f762~ 73e088f2-f8~ Animal~ Chord~ Mamm~ Prob~ Eleph~ Loxo~
 2 924537718 95f132fe-f762~ 73e0ad3c-f8~ Animal~ Chord~ Mamm~ Prob~ Eleph~ Loxo~
 3 924537717 95f132fe-f762~ 73f0f6ec-f8~ Animal~ Chord~ Mamm~ Prob~ Eleph~ Loxo~
 4 923926679 50c9509d-22c7~ http://www.~ Animal~ Chord~ Mamm~ Prob~ Eleph~ Loxo~
 5 923924124 50c9509d-22c7~ http://www.~ Animal~ Chord~ Mamm~ Prob~ Eleph~ Loxo~
 6 922237429 6ac3f774-d9fb~ <NA>         Animal~ Chord~ Mamm~ Prob~ Eleph~ Loxo~
 7 922237412 6ac3f774-d9fb~ <NA>         Animal~ Chord~ Mamm~ Prob~ Eleph~ Loxo~
 8 922237188 6ac3f774-d9fb~ <NA>         Animal~ Chord~ Mamm~ Prob~ Eleph~ Loxo~
 9 922237135 6ac3f774-d9fb~ <NA>         Animal~ Chord~ Mamm~ Prob~ Eleph~ Loxo~
10 922237121 6ac3f774-d9fb~ <NA>         Animal~ Chord~ Mamm~ Prob~ Eleph~ Loxo~
# i 12,527 more rows
# i 41 more variables: species <chr>, infraspecificEpithet <chr>,
#   taxonRank <chr>, scientificName <chr>, verbatimScientificName <chr>,
#   verbatimScientificNameAuthorship <chr>, countryCode <chr>, locality <chr>,
#   stateProvince <chr>, occurrenceStatus <chr>, individualCount <dbl>,
#   publishingOrgKey <chr>, decimalLatitude <dbl>, decimalLongitude <dbl>,
#   coordinateUncertaintyInMeters <dbl>, coordinatePrecision <dbl>, ...
\end{verbatim}

\hypertarget{regional-node-via-galah}{%
\subsubsection{\texorpdfstring{Regional node via
\texttt{galah}}{Regional node via galah}}\label{regional-node-via-galah}}

In order to access data from the Australia node, we will need to
reconfigure \texttt{galah} so that our query points to Australia. After
that, we will download all records for the Pink Robin.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{galah\_config}\NormalTok{(}\AttributeTok{email =} \FunctionTok{Sys.getenv}\NormalTok{(}\StringTok{"ALA\_EMAIL"}\NormalTok{), }
             \AttributeTok{atlas =} \StringTok{"Australia"}\NormalTok{)}

\NormalTok{pink\_robin }\OtherTok{\textless{}{-}} \FunctionTok{galah\_call}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{galah\_identify}\NormalTok{(}\StringTok{"Petroica rodinogaster"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  atlas\_occurrences}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 11,992 x 8
   decimalLatitude decimalLongitude eventDate           scientificName          
 *           <dbl>            <dbl> <dttm>              <chr>                   
 1           -43.7             146. NA                  Petroica (Erythrodryas)~
 2           -43.7             146. NA                  Petroica (Erythrodryas)~
 3           -43.7             146. 1971-02-03 14:00:00 Petroica (Erythrodryas)~
 4           -43.7             146. 2020-10-07 02:39:00 Petroica (Erythrodryas)~
 5           -43.7             146. 2015-09-22 14:00:00 Petroica (Erythrodryas)~
 6           -43.6             146. 2002-01-03 13:00:00 Petroica (Erythrodryas)~
 7           -43.6             146. NA                  Petroica (Erythrodryas)~
 8           -43.6             146. 2020-12-27 13:00:00 Petroica (Erythrodryas)~
 9           -43.6             146. 2021-03-07 13:00:00 Petroica (Erythrodryas)~
10           -43.6             146. 2020-12-26 13:00:00 Petroica (Erythrodryas)~
# i 11,982 more rows
# i 4 more variables: taxonConceptID <chr>, recordID <chr>,
#   dataResourceName <chr>, occurrenceStatus <chr>
\end{verbatim}

\hypertarget{spatial-focus}{%
\subsection{Spatial focus}\label{spatial-focus}}

\hypertarget{choosing-specific-data-columns}{%
\section{Choosing specific data
columns}\label{choosing-specific-data-columns}}

By default, \texttt{atlas\_occurrences} will return a tibble with a
selection of columns containing taxonomic and spatial data as well as
other metadata. Alternatively, you can use \texttt{galah\_select} to
subset the columns that are relevant for your work. To see all available
fields you can choose from:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{show\_all}\NormalTok{(fields) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 611 x 4
   id                    description                                 type  link 
   <chr>                 <chr>                                       <chr> <chr>
 1 abcdTypeStatus        ABCD field in use by herbaria               fiel~ <NA> 
 2 acceptedNameUsage     http://rs.tdwg.org/dwc/terms/acceptedNameU~ fiel~ <NA> 
 3 acceptedNameUsageID   http://rs.tdwg.org/dwc/terms/acceptedNameU~ fiel~ <NA> 
 4 accessRights          <NA>                                        fiel~ <NA> 
 5 assertionUserId       User ID of the person who has made an asse~ fiel~ <NA> 
 6 assertions            A list of all assertions (user and system ~ fiel~ <NA> 
 7 associatedMedia       http://rs.tdwg.org/dwc/terms/associatedMed~ fiel~ <NA> 
 8 associatedOccurrences http://rs.tdwg.org/dwc/terms/associatedOcc~ fiel~ <NA> 
 9 associatedOrganisms   http://rs.tdwg.org/dwc/terms/associatedOrg~ fiel~ <NA> 
10 associatedReferences  http://rs.tdwg.org/dwc/terms/associatedRef~ fiel~ <NA> 
# i 601 more rows
\end{verbatim}

Here, we will choose a smaller subsets of 8 columns to download for the
Pink Robin

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{project\_fields }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"recordID"}\NormalTok{,}
                    \StringTok{"eventDate"}\NormalTok{,}
                    \StringTok{"year"}\NormalTok{, }
                    \StringTok{"basisOfRecord"}\NormalTok{, }
                    \StringTok{"occurrenceStatus"}\NormalTok{,}
                    \StringTok{"scientificName"}\NormalTok{,}
                    \StringTok{"decimalLatitude"}\NormalTok{,}
                    \StringTok{"decimalLongitude"}\NormalTok{)}

\NormalTok{pink\_robin\_projfields }\OtherTok{\textless{}{-}} \FunctionTok{galah\_call}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{galah\_identify}\NormalTok{(}\StringTok{"Petroica rodinogaster"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{galah\_select}\NormalTok{(project\_fields) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{atlas\_occurrences}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 11,992 x 8
   recordID             eventDate            year basisOfRecord occurrenceStatus
 * <chr>                <dttm>              <dbl> <chr>         <chr>           
 1 000fc2ef-b696-4576-~ 1976-12-18 13:00:00  1976 HUMAN_OBSERV~ PRESENT         
 2 001410fd-3a01-43aa-~ 1978-05-23 14:00:00  1978 HUMAN_OBSERV~ PRESENT         
 3 00164a76-0b3a-4b44-~ 1977-12-15 13:00:00  1977 HUMAN_OBSERV~ PRESENT         
 4 001bfca5-4197-40a6-~ 1940-12-31 14:00:00  1941 OBSERVATION   PRESENT         
 5 001e33bd-bb15-4384-~ 2002-10-17 14:00:00  2002 HUMAN_OBSERV~ PRESENT         
 6 0021cc7c-a371-4af6-~ 2016-04-09 14:00:00  2016 OCCURRENCE    PRESENT         
 7 00287e24-87b8-429a-~ 2021-01-14 13:00:00  2021 HUMAN_OBSERV~ PRESENT         
 8 002e05a7-b1bf-4eba-~ 2000-07-24 14:00:00  2000 OBSERVATION   PRESENT         
 9 00327fc2-ae67-467b-~ 1983-11-23 13:00:00  1983 PRESERVED_SP~ PRESENT         
10 0035016f-ae80-494a-~ NA                     NA HUMAN_OBSERV~ PRESENT         
# i 11,982 more rows
# i 3 more variables: scientificName <chr>, decimalLatitude <dbl>,
#   decimalLongitude <dbl>
\end{verbatim}

\hypertarget{refining-your-data-download}{%
\section{Refining your data
download}\label{refining-your-data-download}}

Open access biodiversity data comes from many different providers such
as universities, research institutes (museums and herbariums),
government and the general public. As such, data type and quality can
vary considerably. For example, museums harbour older records that are
associated with a preserved specimen, whereas citizen sourced data are
often images captured from a smart phone.

Refining your download query ensures higher quality data and also
reduces the download size as many data infrastructures impose
constraints to download size. Below we have illustrated how you can
refine your query a few quality measures using \texttt{galah\_filter}.

\hypertarget{by-year}{%
\subsubsection{By Year}\label{by-year}}

Generally, old data records tend to be insufficient or less reliable as
taxonomic knowledge and GPS tools were not readily available. For this
reason, many users consider removing all occurrence records before a
certain year to increase data precision (Gueta and Carmel 2016; J. R.
Marsh et al. 2022) .

Choosing the year `cut-off' is relatively arbitary, but the most
commonly used year is 1945 (Zizka et al. 2020a; Führding-Potschkat,
Kreft, and Ickert-Bond 2022), although some studies discard all data
collected before 1990 (Gueta and Carmel 2016; J. R. Marsh et al. 2022).

Here we will narrow the Pink Robin query from above to records after
1945 using \texttt{galah\_filter}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pink\_robin\_post1945 }\OtherTok{\textless{}{-}} \FunctionTok{galah\_call}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{galah\_identify}\NormalTok{(}\StringTok{"Petroica rodinogaster"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{galah\_filter}\NormalTok{(year }\SpecialCharTok{\textgreater{}} \DecValTok{1945}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{atlas\_occurrences}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{basis-of-record}{%
\subsubsection{Basis of record}\label{basis-of-record}}

Basis of record is a
\href{https://dwc.tdwg.org/terms/\#dwc:basisOfRecord}{Darwin Core term}
that refers to the specific nature of the occurrence record. It can be
used to refine your data download and ensure consistency when
consolidating data from multiple organisations (Führding-Potschkat,
Kreft, and Ickert-Bond 2022).

There are 6 different classes for basis of record:

\begin{itemize}
\tightlist
\item
  Living Specimen - a specimen that is alive, e.g.~a living plant in a
  national park
\item
  Preserved Specimen - a specimen that has been preserved, for example,
  a dried plant on an herbarium sheet
\item
  Fossil Specimen - a preserved specimen that is a fossil
\item
  Material Sample - a genetic or environmental sample
\item
  Material Citation - A reference to, or citation of, a specimen in
  scholarly publications, e.g a citation of a physical specimen in a
  scientific journal
\item
  Human Observation - an output of human observation process
  e.g.~evidence of an occurrence taken from field notes or an occurrence
  without any physical evidence
\item
  Machine Observation - An output of a machine observation process
  e.g.~a photograph, a video, an audio recording, a remote sensing image
  or an occurrence record based on telemetry.
\end{itemize}

Depending on your data scope, it may be practical to limit data that can
be traced to a physical specimen or observation (Godfree et al. 2021),
which we do for the Pink Robin below

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tractable\_records }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"LIVING\_SPECIMEN"}\NormalTok{, }
                       \StringTok{"PRESERVED\_SPECIMEN"}\NormalTok{, }
                       \StringTok{"MATERIAL\_SAMPLE"}\NormalTok{, }
                       \StringTok{"MACHINE\_OBSERVATION"}\NormalTok{)}

\NormalTok{pink\_robin\_tractable }\OtherTok{\textless{}{-}} \FunctionTok{galah\_call}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{galah\_identify}\NormalTok{(}\StringTok{"Petroica rodinogaster"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{galah\_filter}\NormalTok{(basisOfRecord }\SpecialCharTok{==}\NormalTok{ tractable\_records) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{atlas\_occurrences}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{assertions}{%
\subsubsection{Assertions}\label{assertions}}

Data infrastructures use assertions to internally grade the quality,
completeness and consistency of each occurrence record. Assertions take
values of either 1 or 0, indicating the presence or absence of the data
quality issue. Note that assertions may vary depending what atlas you
have configured to. You can see the available assertions and their
descriptions using:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{show\_all}\NormalTok{(}\StringTok{"assertions"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 117 x 4
   id                                 description                 category type 
   <chr>                              <chr>                       <chr>    <chr>
 1 AMBIGUOUS_COLLECTION               Ambiguous collection        Warning  asse~
 2 AMBIGUOUS_INSTITUTION              Ambiguous institution       Warning  asse~
 3 BASIS_OF_RECORD_INVALID            Basis of record badly form~ Warning  asse~
 4 biosecurityIssue                   Biosecurity issue           Error    asse~
 5 COLLECTION_MATCH_FUZZY             Collection match fuzzy      Warning  asse~
 6 COLLECTION_MATCH_NONE              Collection not matched      Warning  asse~
 7 CONTINENT_COUNTRY_MISMATCH         Continent country mismatch  Warning  asse~
 8 CONTINENT_DERIVED_FROM_COORDINATES Continent derived from coo~ Warning  asse~
 9 CONTINENT_INVALID                  Continent invalid           Warning  asse~
10 COORDINATE_ACCURACY_INVALID        Coordinate accuracy invalid Warning  asse~
# i 107 more rows
\end{verbatim}

Once you have decided which assertions are important for your project
you can further refine your download. To retrieve all the assertions for
your query use \texttt{galah\_select(group\ =\ "assertions")}

\bookmarksetup{startatroot}

\hypertarget{precleaning}{%
\chapter{Precleaning}\label{precleaning}}

Precleaning prepares the dataset in a general manner so that it is
formatted in a logical and consistent manner. It is a `broad sweep'
procedure that allows you to familiarise with the data but it also makes
the next stage of in-depth data cleaning proceed more smoothly
(streamdna 2020). We will discuss some approaches on how to be curious
with your data and how to detect and handle string inconsistencies,
missing data and outliers.

\hypertarget{metadata}{%
\section{Metadata}\label{metadata}}

Metadata describes your dataset. It defines each variable and describes
its contents such as what units a variable is measured in. Data
infrastructures that uses Darwin Core terms will have interoperable
metadata. All Darwin Core term definitions can be found
\href{https://dwc.tdwg.org/terms/}{here}, we suggest using
\texttt{Ctrl/CMD\ F} and searching your variable name on the
\href{https://dwc.tdwg.org/terms/}{webpage}. Don't hesitate to Google
variable names if you are unsure what they represent.

If you're using data from particular institutions it's worth checking
the metadata for the entire dataset to delineate if there is extra
information about the data which might limit what you can do with the
data. You could google the dataset name, or search the
dataset/institution on the ALA. The metadata on the ALA is submitted
with the data, it's not always of high standard which is why it's worth
investigating externally, an example of some good metadata is
\href{https://collections.ala.org.au/public/show/dr14760}{FrogID from
the Australian Museum}. A benefit to reading metadata is understanding
the limitations of your dataset. From reading FrogID's metadata (Rowley
and Callaghan 2020), you'll find:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  The data is acoustic data, the majority of the species recorded are
  therefore male
\item
  Because this is citizen science data, it is especially biased towards
  populated areas
\item
  Audio is recorded via a smartphone app, the authors recommend if you
  require high coordinate precision to filter data to
  \texttt{geographic\ uncertainty\ of\ \textless{}3000m}
\item
  The data is presence only data
\end{enumerate}

Metadata can also be useful for understanding the license that the data
falls under, this is mostly relevant for using multimedia associated
with the data.

\hypertarget{initial-inspection}{%
\section{Initial inspection}\label{initial-inspection}}

A great way to get an initial overview of your data is to use the R
package \texttt{skimr}. Importantly \texttt{skimr} produces tables of
descriptive statistics, such as amount of missing data, for every
variable

The output is also grouped by data type (numeric, character, date) so
you can also check for any inconsistencies. As you are looking through
the output, ask yourself whether the data is in line with your
expectation. If you requested data for a group of species, are they all
represented? Are the values for a variable reasonable? Looking at the
quartiles will help you get the sense of the distribution of data. These
considerations will help you detect potential issues in the data.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(skimr)}

\FunctionTok{skim}\NormalTok{(african\_ele)}
\end{Highlighting}
\end{Shaded}

Here is the \texttt{skimr} report for our African elephant dataset we
\protect\hyperlink{sec-download-data}{downloaded earlier}

\begin{longtable}[]{@{}ll@{}}
\caption{Data summary}\tabularnewline
\toprule\noalign{}
\endfirsthead
\endhead
\bottomrule\noalign{}
\endlastfoot
Name & african\_ele \\
Number of rows & 12537 \\
Number of columns & 50 \\
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ & \\
Column type frequency: & \\
character & 31 \\
logical & 1 \\
numeric & 15 \\
POSIXct & 3 \\
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ & \\
Group variables & None \\
\end{longtable}

\textbf{Variable type: character}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.3626}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1099}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1538}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0440}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0440}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0659}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0989}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1209}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
skim\_variable
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_missing
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
complete\_rate
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
min
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
max
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
empty
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_unique
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
whitespace
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
datasetKey & 0 & 1.00 & 36 & 36 & 0 & 132 & 0 \\
occurrenceID & 708 & 0.94 & 1 & 81 & 0 & 11787 & 0 \\
kingdom & 0 & 1.00 & 8 & 8 & 0 & 1 & 0 \\
phylum & 0 & 1.00 & 8 & 8 & 0 & 1 & 0 \\
class & 0 & 1.00 & 8 & 8 & 0 & 1 & 0 \\
order & 0 & 1.00 & 11 & 11 & 0 & 1 & 0 \\
family & 0 & 1.00 & 12 & 12 & 0 & 1 & 0 \\
genus & 0 & 1.00 & 9 & 9 & 0 & 1 & 0 \\
species & 0 & 1.00 & 18 & 18 & 0 & 1 & 0 \\
infraspecificEpithet & 12410 & 0.01 & 8 & 13 & 0 & 2 & 0 \\
taxonRank & 0 & 1.00 & 7 & 10 & 0 & 3 & 0 \\
scientificName & 0 & 1.00 & 12 & 37 & 0 & 5 & 0 \\
verbatimScientificName & 3 & 1.00 & 12 & 53 & 0 & 32 & 0 \\
verbatimScientificNameAuthorship & 10964 & 0.13 & 2 & 31 & 0 & 255 &
0 \\
countryCode & 1461 & 0.88 & 2 & 2 & 0 & 44 & 0 \\
locality & 9211 & 0.27 & 3 & 254 & 0 & 686 & 0 \\
stateProvince & 3573 & 0.72 & 3 & 43 & 0 & 182 & 0 \\
occurrenceStatus & 0 & 1.00 & 6 & 7 & 0 & 2 & 0 \\
publishingOrgKey & 0 & 1.00 & 36 & 36 & 0 & 102 & 0 \\
basisOfRecord & 0 & 1.00 & 10 & 19 & 0 & 9 & 0 \\
institutionCode & 1325 & 0.89 & 2 & 76 & 0 & 103 & 0 \\
collectionCode & 1353 & 0.89 & 1 & 41 & 0 & 164 & 0 \\
catalogNumber & 1553 & 0.88 & 1 & 36 & 0 & 10866 & 0 \\
recordNumber & 12420 & 0.01 & 1 & 37 & 0 & 77 & 0 \\
identifiedBy & 4646 & 0.63 & 2 & 81 & 0 & 1464 & 0 \\
license & 0 & 1.00 & 7 & 12 & 0 & 3 & 0 \\
rightsHolder & 4240 & 0.66 & 2 & 56 & 0 & 1634 & 0 \\
recordedBy & 2138 & 0.83 & 1 & 160 & 0 & 1972 & 0 \\
establishmentMeans & 12249 & 0.02 & 6 & 6 & 0 & 1 & 0 \\
mediaType & 5021 & 0.60 & 5 & 16 & 0 & 4 & 0 \\
issue & 397 & 0.97 & 15 & 191 & 0 & 130 & 0 \\
\end{longtable}

\textbf{Variable type: logical}

\begin{longtable}[]{@{}lrrrl@{}}
\toprule\noalign{}
skim\_variable & n\_missing & complete\_rate & mean & count \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
typeStatus & 12537 & 0 & NaN & : \\
\end{longtable}

\textbf{Variable type: numeric}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.1961}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0654}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0915}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0915}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0850}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0784}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0915}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0915}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0850}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0850}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0392}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
skim\_variable
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_missing
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
complete\_rate
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
mean
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
sd
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p0
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p25
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p50
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p75
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p100
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
hist
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
gbifID & 0 & 1.00 & 2535815516.94 & 960444243.67 & 49926810.00 &
1802649142.00 & 2465251941.00 & 3.351048e+09 & 4.029318e+09 & ▁▅▇▅▇ \\
individualCount & 10226 & 0.18 & 4.81 & 14.03 & 0.00 & 1.00 & 1.00 &
2.000000e+00 & 2.920000e+02 & ▇▁▁▁▁ \\
decimalLatitude & 1350 & 0.89 & -10.01 & 14.67 & -34.58 & -24.06 & -6.25
& 4.800000e-01 & 5.215000e+01 & ▇▅▅▁▁ \\
decimalLongitude & 1350 & 0.89 & 25.56 & 12.35 & -122.33 & 22.97 & 31.08
& 3.480000e+01 & 4.053000e+01 & ▁▁▁▂▇ \\
coordinateUncertaintyInMeters & 3966 & 0.68 & 41636.59 & 158053.45 &
1.00 & 29775.00 & 30580.00 & 3.142200e+04 & 5.635548e+06 & ▇▁▁▁▁ \\
coordinatePrecision & 12512 & 0.00 & 0.00 & 0.00 & 0.00 & 0.00 & 0.00 &
0.000000e+00 & 0.000000e+00 & ▁▁▁▁▇ \\
elevation & 12501 & 0.00 & 154.42 & 421.59 & 0.00 & 0.00 & 0.00 &
1.375000e+01 & 2.134000e+03 & ▇▁▁▁▁ \\
elevationAccuracy & 12507 & 0.00 & 0.83 & 3.73 & 0.00 & 0.00 & 0.00 &
0.000000e+00 & 2.000000e+01 & ▇▁▁▁▁ \\
depth & 12509 & 0.00 & 0.00 & 0.00 & 0.00 & 0.00 & 0.00 & 0.000000e+00 &
0.000000e+00 & ▁▁▇▁▁ \\
depthAccuracy & 12509 & 0.00 & 0.00 & 0.00 & 0.00 & 0.00 & 0.00 &
0.000000e+00 & 0.000000e+00 & ▁▁▇▁▁ \\
day & 1254 & 0.90 & 16.27 & 8.74 & 1.00 & 9.00 & 17.00 & 2.400000e+01 &
3.100000e+01 & ▇▆▇▇▇ \\
month & 1191 & 0.91 & 6.92 & 3.33 & 1.00 & 4.00 & 7.00 & 1.000000e+01 &
1.200000e+01 & ▆▅▅▇▇ \\
year & 997 & 0.92 & 2011.05 & 19.34 & 1799.00 & 2011.00 & 2016.00 &
2.019000e+03 & 2.023000e+03 & ▁▁▁▁▇ \\
taxonKey & 0 & 1.00 & 2517047.48 & 747546.46 & 2435350.00 & 2435350.00 &
2435350.00 & 2.435350e+06 & 1.150335e+07 & ▇▁▁▁▁ \\
speciesKey & 0 & 1.00 & 2435350.00 & 0.00 & 2435350.00 & 2435350.00 &
2435350.00 & 2.435350e+06 & 2.435350e+06 & ▁▁▇▁▁ \\
\end{longtable}

\textbf{Variable type: POSIXct}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1468}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.0917}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1284}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1835}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1835}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1835}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.0826}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
skim\_variable
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_missing
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
complete\_rate
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
min
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
max
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
median
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_unique
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
eventDate & 997 & 0.92 & 1799-01-01 00:00:00 & 2023-02-07 09:17:14 &
2016-02-07 12:00:00 & 8324 \\
dateIdentified & 4150 & 0.67 & 1783-01-01 00:00:00 & 2023-02-07 21:51:36
& 2020-04-16 19:35:25 & 7242 \\
lastInterpreted & 0 & 1.00 & 2023-01-24 14:57:46 & 2023-02-14 01:52:09 &
2023-02-13 16:01:27 & 10885 \\
\end{longtable}

\hypertarget{structural-inconsistencies}{%
\section{Structural inconsistencies}\label{structural-inconsistencies}}

\hypertarget{string-inconsistencies}{%
\subsection{String inconsistencies}\label{string-inconsistencies}}

String inconsistencies include mispellings, capitalisation errors,
misplaced punctuations or trailing white spaces. We will use the
\texttt{janitor} R package to explore whether our data has any of these
issues. The function \texttt{tabyl} will compute a counts and percent of
total rows for each unique value.

We recommend \texttt{tabyl-ing} any character strings that are relevant
to your project. For example, here is the
\href{https://dwc.tdwg.org/terms/\#dwc:stateProvince}{\texttt{stateProvince}}
in alphabetical order.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(janitor)}

\NormalTok{african\_ele }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pull}\NormalTok{(stateProvince) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tabyl}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tibble}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{print}\NormalTok{(}\AttributeTok{n =} \DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 183 x 4
   .                     n   percent valid_percent
   <chr>             <int>     <dbl>         <dbl>
 1 Agadez                1 0.0000798      0.000112
 2 Al Qahirah            1 0.0000798      0.000112
 3 Alibori             601 0.0479         0.0670  
 4 Arusha              231 0.0184         0.0258  
 5 Arusha Region         1 0.0000798      0.000112
 6 Atacora             366 0.0292         0.0408  
 7 Atakora             239 0.0191         0.0267  
 8 Balaka                7 0.000558       0.000781
 9 Bassila               1 0.0000798      0.000112
10 Batha                 1 0.0000798      0.000112
11 Bauchi                3 0.000239       0.000335
12 Bengo                 3 0.000239       0.000335
13 Borgou                7 0.000558       0.000781
14 Budongo Forest        1 0.0000798      0.000112
15 Bushenyi             61 0.00487        0.00680 
16 Cabo Delgado          2 0.000160       0.000223
17 Cape Prov.            2 0.000160       0.000223
18 Cape Province         1 0.0000798      0.000112
19 Central             113 0.00901        0.0126  
20 Central Equatoria     2 0.000160       0.000223
# i 163 more rows
\end{verbatim}

From the \texttt{tabyl} output, we can see there are few different
variations of \texttt{Province}, \texttt{Prov.}, \texttt{Prov}. As an
example, we will correct these with the \texttt{tidyverse} packages
\texttt{stringr}, \texttt{dplyr}, \texttt{tidyr} as well as
\texttt{glue}. If you are not very familiar with regular expressions, we
highly recommend this
\href{https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf}{cheatsheet}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(glue)}

\CommentTok{\# Create a regular expression to match Prov. and Prov}
\CommentTok{\# The pattern below means Prov that is NOT followed by any lowercase letters}
\NormalTok{pattern }\OtherTok{=} \FunctionTok{regex}\NormalTok{(}\StringTok{"Prov(?![:lower:])"}\NormalTok{)}

\CommentTok{\# Use \textasciigrave{}str\_subset\textasciigrave{} to pull out the cases that match our pattern}
\CommentTok{\# Confirm that these are the problematic ones}
\CommentTok{\# Assign these into an object}
\FunctionTok{str\_subset}\NormalTok{(african\_ele}\SpecialCharTok{$}\NormalTok{stateProvince, }\AttributeTok{pattern =}\NormalTok{ pattern)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "Cape Prov."        "Cape Prov."        "West Nile Prov."  
 [4] "Central Prov"      "Central Prov"      "Coastal Prov"     
 [7] "Northeastern Prov" "Central Prov"      "Eastern Prov"     
[10] "Coastal Prov"     
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{typos\_provinces }\OtherTok{\textless{}{-}} \FunctionTok{str\_subset}\NormalTok{(african\_ele}\SpecialCharTok{$}\NormalTok{stateProvince, }\AttributeTok{pattern =}\NormalTok{ pattern)}

\CommentTok{\# Create a new variable \textasciigrave{}stateProvince\_clean\textasciigrave{} using \textasciigrave{}mutate\textasciigrave{}, \textasciigrave{}if\_else\textasciigrave{}, \textasciigrave{}str\_detect\textasciigrave{} and \textasciigrave{}glue\textasciigrave{}}
\CommentTok{\# \textasciigrave{}str\_detect\textasciigrave{} will evaluate values of \textasciigrave{}stateProvince\textasciigrave{} that matches our pattern we defined earlier.}
\CommentTok{\# Matches will return TRUE, non{-}matches will return FALSE. }
\CommentTok{\# The \textasciigrave{}if\_else\textasciigrave{} will then evaluate these logicals (TRUE/FALSE/NA) }
\CommentTok{\# for TRUE values, the \textasciigrave{}glue\textasciigrave{} function will take the first part of the province name enclosed in and join it with word Province.}
\CommentTok{\# for FALSE values , it will just take the corresponding value in stateProvince}
\CommentTok{\# Note that we are assigning these changes to a new object (\textasciigrave{}african\_ele\_2\textasciigrave{})}
\NormalTok{african\_ele\_2 }\OtherTok{\textless{}{-}}\NormalTok{ african\_ele }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{stateProvince\_clean =} \FunctionTok{if\_else}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(stateProvince, }\AttributeTok{pattern =}\NormalTok{ pattern),}
                                      \AttributeTok{true =} \FunctionTok{glue}\NormalTok{(}\StringTok{\textquotesingle{}\{word(stateProvince, sep = " P")\} Province\textquotesingle{}}\NormalTok{),}
                                      \AttributeTok{false =}\NormalTok{ stateProvince)}
\NormalTok{         ) }

\CommentTok{\# Once we\textquotesingle{}ve made the correction we want to check we\textquotesingle{}ve done it correctly.}
\CommentTok{\# ALWAYS CHECK YOUR CORRECTIONS}
\CommentTok{\# Use the \textasciigrave{}select\textasciigrave{} function to isolate columns that \textasciigrave{}starts\_with\textasciigrave{} "stateProvince"}
\CommentTok{\# Use the \textasciigrave{}filter\textasciigrave{} function to subset our the problematic provinces }
\NormalTok{african\_ele\_2 }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"stateProvince"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(stateProvince }\SpecialCharTok{\%in\%}\NormalTok{ typos\_provinces)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 10 x 2
   stateProvince     stateProvince_clean  
   <chr>             <glue>               
 1 Cape Prov.        Cape Province        
 2 Cape Prov.        Cape Province        
 3 West Nile Prov.   West Nile Province   
 4 Central Prov      Central Province     
 5 Central Prov      Central Province     
 6 Coastal Prov      Coastal Province     
 7 Northeastern Prov Northeastern Province
 8 Central Prov      Central Province     
 9 Eastern Prov      Eastern Province     
10 Coastal Prov      Coastal Province     
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Its good practice to check the other values were not affected by your corrections}
\CommentTok{\# Here we are removing the NA with \textasciigrave{}drop\_na\textasciigrave{} and subsetting unique rows with \textasciigrave{}distinct\textasciigrave{}}
\NormalTok{african\_ele\_2 }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"stateProvince"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{drop\_na}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{distinct}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 182 x 2
   stateProvince    stateProvince_clean
   <chr>            <glue>             
 1 Southern         Southern           
 2 Taita Taveta     Taita Taveta       
 3 Mara             Mara               
 4 Arusha           Arusha             
 5 Simiyu           Simiyu             
 6 Morogoro         Morogoro           
 7 Mashonaland West Mashonaland West   
 8 Mpumalanga       Mpumalanga         
 9 KwaZulu-Natal    KwaZulu-Natal      
10 Manicaland       Manicaland         
# i 172 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Final check}
\CommentTok{\# Check with the original code that detected the issue}
\NormalTok{african\_ele\_2 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pull}\NormalTok{(stateProvince\_clean) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tabyl}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tibble}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{print}\NormalTok{(}\AttributeTok{n =} \DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 181 x 4
   .                     n   percent valid_percent
   <glue>            <int>     <dbl>         <dbl>
 1 Agadez                1 0.0000798      0.000112
 2 Al Qahirah            1 0.0000798      0.000112
 3 Alibori             601 0.0479         0.0670  
 4 Arusha              231 0.0184         0.0258  
 5 Arusha Region         1 0.0000798      0.000112
 6 Atacora             366 0.0292         0.0408  
 7 Atakora             239 0.0191         0.0267  
 8 Balaka                7 0.000558       0.000781
 9 Bassila               1 0.0000798      0.000112
10 Batha                 1 0.0000798      0.000112
11 Bauchi                3 0.000239       0.000335
12 Bengo                 3 0.000239       0.000335
13 Borgou                7 0.000558       0.000781
14 Budongo Forest        1 0.0000798      0.000112
15 Bushenyi             61 0.00487        0.00680 
16 Cabo Delgado          2 0.000160       0.000223
17 Cape Province         3 0.000239       0.000335
18 Central             113 0.00901        0.0126  
19 Central Equatoria     2 0.000160       0.000223
20 Central Province      4 0.000319       0.000446
# i 161 more rows
\end{verbatim}

There are some other issues that can be corrected in a similar approach:

\begin{itemize}
\tightlist
\item
  \texttt{North\ West}, \texttt{North\ West\ District} and
  \texttt{North-Western}
\item
  \texttt{Àfrica\ Central}, \texttt{Central\ Province} and
  \texttt{Central}
\item
  \texttt{Atacora} and \texttt{Atakora}
\item
  \texttt{Coastal\ Province} and \texttt{Coastal}
\end{itemize}

We recommend consulting reputable sources that can help delineate or
consolidate similar values. Googling and looking at Wikipedia's sources
are good places to find resources that you can verify accepted state and
province names.

\bookmarksetup{startatroot}

\hypertarget{sec-standardise-taxonomy}{%
\chapter{Taxonomy}\label{sec-standardise-taxonomy}}

Advances in taxonomy, especially in molecular biology has allowed
researchers to describe new species more efficiently than ever before
(Garraffoni et al. 2019). Modern approaches has also enabled
reclassification of organisms that have been incorrectly described in
the past. Unfortunately, multiple names (synonyms) for the same organism
can arise when taxonomy is not unanimously agreed upon by researchers.

Harmonising taxonomic names is a prevalent and complex issue and so far,
no unifying solution has been put forward --- making research with
biodiversity data challenging. A potential solution would require
pulling together domain knowledge from experts and compiling a database
for where taxonomic history for describe species is traceable and linked
with published literature.

While there is no perfect solution, some tips, tricks and tools do
exist. In this chapter we will go through some of these to clean
taxonomic data and deal with synonyms.

\hypertarget{taxonomy-preclean}{%
\section{Taxonomy preclean}\label{taxonomy-preclean}}

Similar to what we did in the previous chapter, we will apply a broad
sweep pre-clean to taxonomic data. This will make dealing with synonyms
go as smoothly as possible.

The process is to first identify the issue, correct it, check it, and
then document the changes. The goal is to standardise and correct as
many errors issues before removing records.

\hypertarget{capitalisation}{%
\subsection{Capitalisation}\label{capitalisation}}

Normally higher taxonomy are capitalised e.g.~Myrtaceae or Aves.
Capitalisation errors are usually quick to spot when you print the data
object. Alternatively you can try using \texttt{str\_subset} on columns
you expect to have capital letters.

The code below subsets out unique values for the variable \texttt{class}
that have upper case letters. Notice that no matches are found

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}

\FunctionTok{str\_subset}\NormalTok{(}\FunctionTok{unique}\NormalTok{(bees}\SpecialCharTok{$}\NormalTok{class), }\StringTok{"[:upper:]"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
character(0)
\end{verbatim}

We can confirm that there are no upper case matches by subsetting unique
values that have lower case letters to see what is going on. This shows
us that Insecta is inputted entirely in lowercase.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_subset}\NormalTok{(}\FunctionTok{unique}\NormalTok{(bees}\SpecialCharTok{$}\NormalTok{class), }\StringTok{"[:lower:]"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "insecta"
\end{verbatim}

We can correct the lower case formatting as below, remember to check the
fix before overwriting/removing the erroneous column(s)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bees }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{class\_corrected =} \FunctionTok{str\_to\_sentence}\NormalTok{(class)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"class"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 1,139 x 2
   class   class_corrected
   <chr>   <chr>          
 1 insecta Insecta        
 2 insecta Insecta        
 3 insecta Insecta        
 4 insecta Insecta        
 5 insecta Insecta        
 6 insecta Insecta        
 7 insecta Insecta        
 8 insecta Insecta        
 9 insecta Insecta        
10 insecta Insecta        
# i 1,129 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bees\_corrected }\OtherTok{\textless{}{-}}\NormalTok{ bees }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{class\_corrected =} \FunctionTok{str\_to\_sentence}\NormalTok{(class)) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{class) }\SpecialCharTok{|\textgreater{}} \CommentTok{\# Remove erroreous column }
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{class =}\NormalTok{ class\_corrected) }\CommentTok{\# Rename corrected column as the new \textquotesingle{}class\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{seperators}{%
\subsection{Seperators}\label{seperators}}

In a taxonomic data, separators such as, spaces and underscore are found
in scientific names and are used to delineate the genus and
\href{https://dwc.tdwg.org/terms/\#dwc:specificEpithet}{species name}.
While it is personal choice which separator you use, it is good practice
to be consistent with your choice. Consistency ensures that unique
values of scientific name truly reflects unique species and not due to
inconsistencies.

Try \texttt{tabyl-ing} your taxonomic columns to check if you have any
inconsistencies first

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(janitor)}

\NormalTok{plants }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{pull}\NormalTok{(scientific\_name) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{tabyl}\NormalTok{() }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{tibble}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 623 x 3
   `pull(plants, scientific_name)`         n  percent
   <chr>                               <int>    <dbl>
 1 Acacia asparagoides                     2 0.000962
 2 Acacia barakulensis                     1 0.000481
 3 Acacia barringtonensis                  2 0.000962
 4 Acacia beadleana                        1 0.000481
 5 Acacia betchei                          6 0.00289 
 6 Acacia blayana                          2 0.000962
 7 Acacia brunioides                       1 0.000481
 8 Acacia brunioides subsp. brunioides     6 0.00289 
 9 Acacia brunioides subsp. granitica      1 0.000481
10 Acacia bulgaensis                       3 0.00144 
# i 613 more rows
\end{verbatim}

Consistent taxonomic formatting may not be an issue if you are
downloading data from one single source such as the ALA where scientific
names are already formatted consistently e.g.~``Moloch horridus''. This
may not be the case when consolidating data from multiple sources.

Below is code to create an underscore scientific name from one that is
separated with a space. Remember to check your changes

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plants\_updated }\OtherTok{\textless{}{-}}\NormalTok{ plants }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{scientific\_name\_undersc =} \FunctionTok{str\_replace\_all}\NormalTok{(scientific\_name, }\StringTok{" "}\NormalTok{, }\StringTok{"\_"}\NormalTok{)) }

\NormalTok{plants\_updated }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{pull}\NormalTok{(scientific\_name\_undersc) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{tabyl}\NormalTok{() }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{tibble}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 623 x 3
   `pull(plants_updated, scientific_name_undersc)`     n  percent
   <chr>                                           <int>    <dbl>
 1 Acacia_asparagoides                                 2 0.000962
 2 Acacia_barakulensis                                 1 0.000481
 3 Acacia_barringtonensis                              2 0.000962
 4 Acacia_beadleana                                    1 0.000481
 5 Acacia_betchei                                      6 0.00289 
 6 Acacia_blayana                                      2 0.000962
 7 Acacia_brunioides                                   1 0.000481
 8 Acacia_brunioides_subsp._brunioides                 6 0.00289 
 9 Acacia_brunioides_subsp._granitica                  1 0.000481
10 Acacia_bulgaensis                                   3 0.00144 
# i 613 more rows
\end{verbatim}

\hypertarget{higher-taxonomy}{%
\subsection{Higher taxonomy}\label{higher-taxonomy}}

Higher taxonomy such as phylum and class may be used to group species
for analysis or data visualisations. Its important to check the spelling
and formatting of these columns. Its always good to start with some a
useful table of counts for each taxonomic level. Keep an eye out for
spelling errors, formatting issues and missing data. Note that
\texttt{NA} in the output represents missing

As an example:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(janitor)}

\NormalTok{plants }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{pull}\NormalTok{(class) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{tabyl}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 pull(plants, class)    n     percent valid_percent
         Cycadopsida    4 0.001924002   0.001937046
       Equisetopsida  202 0.097162097   0.097820823
      Lycopodiopsida   10 0.004810005   0.004842615
       Magnoliopsida 1822 0.876382876   0.882324455
           Pinopsida    2 0.000962001   0.000968523
      Polypodiopsida   25 0.012025012   0.012106538
                <NA>   14 0.006734007            NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plants }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{pull}\NormalTok{(order) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{tabyl}\NormalTok{() }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 pull(plants, order)   n     percent valid_percent
         Alismatales   6 0.002886003   0.002939735
             Apiales  36 0.017316017   0.017638413
         Asparagales  67 0.032227032   0.032827046
           Asterales 158 0.075998076   0.077413033
    Austrobaileyales   6 0.002886003   0.002939735
          Canellales   5 0.002405002   0.002449780
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plants }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{pull}\NormalTok{(genus) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{tabyl}\NormalTok{() }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{tail}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 pull(plants, genus)  n     percent valid_percent
               Viola  5 0.002405002   0.002501251
          Westringia 12 0.005772006   0.006003002
           Xanthosia  9 0.004329004   0.004502251
               Xyris  4 0.001924002   0.002001001
              Zieria 14 0.006734007   0.007003502
                <NA> 80 0.038480038            NA
\end{verbatim}

\hypertarget{missing-higher-taxonomy}{%
\subsubsection*{Missing higher taxonomy}\label{missing-higher-taxonomy}}
\addcontentsline{toc}{subsubsection}{Missing higher taxonomy}

If you noticed you have missing data in these columns, you can usually
back fill this information using your
\href{link\%20back\%20to\%20section}{chosen naming authority} or
retrieving this information from a living atlas such as the ALA.

The code below demonstrates how you can isolate the
\texttt{scientific\_names} of taxa with missing data and searching for
taxonomic information from ALA

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(galah)}

\CommentTok{\# Configure galah to point to Australia node}
\FunctionTok{galah\_config}\NormalTok{(}\AttributeTok{atlas =} \StringTok{"Australia"}\NormalTok{,}
             \AttributeTok{email =} \FunctionTok{Sys.getenv}\NormalTok{(}\StringTok{"ALA\_EMAIL"}\NormalTok{))}

\CommentTok{\# These are the taxa missing \textasciigrave{}class\textasciigrave{} information}
\NormalTok{to\_search }\OtherTok{\textless{}{-}}\NormalTok{ inverts }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(class)) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{select}\NormalTok{(scientific\_name) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{distinct}\NormalTok{()}

\CommentTok{\# Reformat scientific\_name to scientificName as the latter is the ALA format}
\NormalTok{backfilled\_taxa }\OtherTok{\textless{}{-}}\NormalTok{ to\_search}\SpecialCharTok{|\textgreater{}}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{scientificName =}\NormalTok{ scientific\_name) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{search\_taxa}\NormalTok{(to\_search) }\SpecialCharTok{|\textgreater{}} \FunctionTok{tibble}\NormalTok{()}

\NormalTok{backfilled\_taxa}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 818 x 15
   search_term     scientific_name scientific_name_auth~1 taxon_concept_id rank 
   <chr>           <chr>           <chr>                  <chr>            <chr>
 1 Idiosoma manst~ Idiosoma manst~ (Pocock, 1897)         https://biodive~ spec~
 2 Holonuncia rec~ Holonuncia rec~ Hunt, 1992             https://biodive~ spec~
 3 Trachycosmus s~ Trachycosmus s~ Simon, 1893            https://biodive~ spec~
 4 Pseudotyrannoc~ Pseudotyrannoc~ Beier, 1971            https://biodive~ spec~
 5 Phryganoporus ~ Phryganoporus ~ (L. Koch, 1872)        https://biodive~ spec~
 6 Latrodectus ha~ Latrodectus ha~ Thorell, 1870          https://biodive~ spec~
 7 Ascoschoengast~ Ascoschoengast~ (Hirst, 1915)          https://biodive~ spec~
 8 Chrestobunus f~ Chrestobunus f~ Hickman, 1958          https://biodive~ spec~
 9 Supunna picta   Nyssus colorip~ Walckenaer, 1805       https://biodive~ spec~
10 Tasmanicosa le~ Tasmanicosa le~ (Thorell, 1870)        https://biodive~ spec~
# i 808 more rows
# i abbreviated name: 1: scientific_name_authorship
# i 10 more variables: match_type <chr>, kingdom <chr>, phylum <chr>,
#   class <chr>, order <chr>, family <chr>, genus <chr>, species <chr>,
#   issues <chr>, vernacular_name <chr>
\end{verbatim}

\hypertarget{insufficient-taxonomic-rank}{%
\subsubsection*{Insufficient taxonomic
rank}\label{insufficient-taxonomic-rank}}
\addcontentsline{toc}{subsubsection}{Insufficient taxonomic rank}

If a record is not identified down to the taxonomic level that needed
for the study e.g.~species, then the record should be removed.

During your data download, ensure you have requested for the column
\href{https://dwc.tdwg.org/terms/\#dwc:taxonRank}{\texttt{taxonRank}},
this variable tells us the lowest level of \texttt{scientificName}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(galah)}

\FunctionTok{galah\_config}\NormalTok{(}\AttributeTok{email =} \FunctionTok{Sys.getenv}\NormalTok{(}\StringTok{"ALA\_EMAIL"}\NormalTok{),}
             \AttributeTok{atlas =} \StringTok{"Australia"}\NormalTok{)}

\NormalTok{honeyeaters }\OtherTok{\textless{}{-}} \FunctionTok{galah\_call}\NormalTok{() }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{galah\_identify}\NormalTok{(}\StringTok{"Meliphagidae"}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{galah\_filter}\NormalTok{(year }\SpecialCharTok{==} \DecValTok{2012} \SpecialCharTok{\&}\NormalTok{ stateProvince }\SpecialCharTok{==} \StringTok{"New South Wales"}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{galah\_select}\NormalTok{(}\AttributeTok{group =} \StringTok{"basic"}\NormalTok{, taxonRank) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{atlas\_occurrences}\NormalTok{()}

\NormalTok{honeyeaters}\SpecialCharTok{$}\NormalTok{taxonRank }\SpecialCharTok{|\textgreater{}} \FunctionTok{unique}\NormalTok{()}

\NormalTok{honeyeaters }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(taxonRank }\SpecialCharTok{==} \StringTok{"species"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(arrow)}
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# honeyeaters \textless{}{-} galah\_call() |\textgreater{}}
\CommentTok{\#   galah\_identify("Meliphagidae") |\textgreater{}}
\CommentTok{\#   galah\_filter(year == 2012 \& stateProvince == "New South Wales") |\textgreater{}}
\CommentTok{\#   galah\_select(group = "basic", taxonRank) |\textgreater{}}
\CommentTok{\#   atlas\_occurrences()}

\CommentTok{\# write\_parquet(honeyeaters, "data/galah/honeyeater")}

\NormalTok{honeyeaters }\OtherTok{\textless{}{-}} \FunctionTok{open\_dataset}\NormalTok{(}\StringTok{"data/galah/honeyeater"}\NormalTok{) }\SpecialCharTok{|\textgreater{}} \FunctionTok{collect}\NormalTok{()}

\NormalTok{honeyeaters}\SpecialCharTok{$}\NormalTok{taxonRank }\SpecialCharTok{|\textgreater{}} \FunctionTok{unique}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "species"    "genus"      "subgenus"   "subspecies" "family"    
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{honeyeaters }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(taxonRank }\SpecialCharTok{==} \StringTok{"species"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 43,684 x 9
   decimalLatitude decimalLongitude eventDate           scientificName          
             <dbl>            <dbl> <dttm>              <chr>                   
 1           -37.4             150. 2012-09-26 14:00:00 Meliphaga (Meliphaga) l~
 2           -37.4             150. 2012-09-26 14:00:00 Acanthorhynchus tenuiro~
 3           -37.4             150. 2012-04-07 14:00:00 Acanthorhynchus tenuiro~
 4           -37.4             150. 2012-04-07 14:00:00 Nesoptilotis leucotis   
 5           -37.4             150. 2012-04-07 14:00:00 Phylidonyris (Meliornis~
 6           -37.4             150. 2012-04-07 14:00:00 Phylidonyris (Phylidony~
 7           -37.4             150. 2012-04-07 14:00:00 Nesoptilotis leucotis   
 8           -37.4             150. 2012-04-07 14:00:00 Phylidonyris (Meliornis~
 9           -37.4             150. 2012-04-07 14:00:00 Melithreptus (Melithrep~
10           -37.4             150. 2012-04-07 14:00:00 Acanthorhynchus tenuiro~
# i 43,674 more rows
# i 5 more variables: taxonConceptID <chr>, recordID <chr>,
#   dataResourceName <chr>, occurrenceStatus <chr>, taxonRank <chr>
\end{verbatim}

\hypertarget{inconsistent-higher-taxonomy}{%
\subsubsection*{Inconsistent higher
taxonomy}\label{inconsistent-higher-taxonomy}}
\addcontentsline{toc}{subsubsection}{Inconsistent higher taxonomy}

A great approach to detect inconsistencies in your taxonomic data is to
compute counts for each level of taxonomic rank. These counts act as a
check for you to verify that the data is in line with your expectation.
This is particularly important when combining data from different
sources where their taxonomy might vary. If you have detected
inconsistencies as we have done below, you will have to correct
accordingly, either by consulting a taxonomic expert or a naming
authority and ensure this is reported in your methods.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get counts for every species where they have more than 1 class}
\NormalTok{plants }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{select}\NormalTok{(phylum}\SpecialCharTok{:}\NormalTok{species, scientific\_name) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{distinct}\NormalTok{() }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{group\_by}\NormalTok{(species) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{n\_class =} \FunctionTok{length}\NormalTok{(}\FunctionTok{unique}\NormalTok{(class))) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(n\_class }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 1 x 2
  species               n_class
  <chr>                   <int>
1 Allocasuarina distyla       2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get the species that have more than 1 class}
\NormalTok{inconsistent\_taxa }\OtherTok{\textless{}{-}}\NormalTok{ plants }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{select}\NormalTok{(phylum}\SpecialCharTok{:}\NormalTok{species, scientific\_name) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{distinct}\NormalTok{() }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{group\_by}\NormalTok{(species) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{n\_class =} \FunctionTok{length}\NormalTok{(}\FunctionTok{unique}\NormalTok{(class))) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(n\_class }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{pull}\NormalTok{(species) }

\CommentTok{\# Filter species that have more than 1 class}
\NormalTok{plants }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(species }\SpecialCharTok{\%in\%}\NormalTok{ inconsistent\_taxa) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{select}\NormalTok{(phylum}\SpecialCharTok{:}\NormalTok{species, scientific\_name) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{arrange}\NormalTok{(species) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{distinct}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2 x 7
  phylum       class         order   family        genus species scientific_name
  <chr>        <chr>         <chr>   <chr>         <chr> <chr>   <chr>          
1 Tracheophyta Magnoliopsida Fagales Casuarinaceae Allo~ Alloca~ Allocasuarina ~
2 Tracheophyta Equisetopsida Fagales Casuarinaceae Allo~ Alloca~ Allocasuarina ~
\end{verbatim}

\hypertarget{synonyms}{%
\section{Synonyms}\label{synonyms}}

Synonyms is a complex issue when working with open source biodiversity
data. Data infrastructures have their own taxonomic systems which may
not align with researchers' view or consistent with your chosen
\href{link_back}{naming authority}.

Keeping in mind that there is no universal solution to synonymy. Best
practice is to flag and correct synonyms in a clear and consistent
manner. We recommend being explicit with your decisions about which
names are retained and keeping a good record of the changes to aid
transparency and reproducibility.

\hypertarget{worrms}{%
\subsubsection*{\{worrms\}}\label{worrms}}
\addcontentsline{toc}{subsubsection}{\{worrms\}}

The \href{https://docs.ropensci.org/worrms/}{\{worrms\}} is the R
interface to the World Register of Marine Species and has a ability to
cross check synonyms with their database for taxa that has an
\texttt{AphiaID}. The function will return synonymous record(s)
associated with another different AphiaID.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(worrms)}

\NormalTok{marine\_sp }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"data/worms/worms.csv"}\NormalTok{)}

\NormalTok{marine\_sp }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{slice}\NormalTok{(}\DecValTok{7}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pull}\NormalTok{(AphiaID) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{wm\_synonyms}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 1 x 27
  AphiaID url   scientificname authority status unacceptreason taxonRankID rank 
    <int> <chr> <chr>          <chr>     <chr>  <lgl>                <int> <chr>
1  453207 http~ Goniosoma ina~ Walker, ~ super~ NA                     220 Spec~
# i 19 more variables: valid_AphiaID <int>, valid_name <chr>,
#   valid_authority <chr>, parentNameUsageID <int>, kingdom <chr>,
#   phylum <chr>, class <chr>, order <chr>, family <chr>, genus <chr>,
#   citation <chr>, lsid <chr>, isMarine <int>, isBrackish <int>,
#   isFreshwater <int>, isTerrestrial <int>, isExtinct <int>, match_type <chr>,
#   modified <chr>
\end{verbatim}

\hypertarget{taxize}{%
\subsubsection*{\{taxize\}}\label{taxize}}
\addcontentsline{toc}{subsubsection}{\{taxize\}}

\{taxize\} allows users to search over many taxonomic data sources for
species names (scientific and common) to resolve synonymy. The
\texttt{gnr\_resolve()} function matches your supplied list with up to
118 data sources including GBIF, Catalogue of Life, World Register of
Marine Species and many more. The function scores how well matched your
name is to these sources.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(taxize)}

\CommentTok{\# Read in a naming authority list}
\NormalTok{afd }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"data/naming/afd.csv"}\NormalTok{)}
\FunctionTok{unique}\NormalTok{(afd}\SpecialCharTok{$}\NormalTok{VALID\_NAME)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "Prosphaerosyllis battiri"         "Clavellopsis parasargi"          
 [3] "Platypontonia hyotis"             "Palirhoeus eatoni"               
 [5] "Diastylis kapalae"                "Xenobates chinai"                
 [7] "Paratanais gaspodei"              "Paradexamine flindersi"          
 [9] "Prostebbingia brevicornis"        "Cythere lactea"                  
[11] "Cythere melobesioides"            "Achelia transfugoides"           
[13] "Halobates (Halobates) acherontis" "Quadraceps hopkinsi apophoretus" 
[15] "Anabarhynchus striatus"           "Australocytheridea vandenboldi"  
[17] "Enigmaplax littoralis"            "Hyphalus insularis"              
[19] "Plesiopenaeus armatus"            "Uroptychus brucei"               
[21] "Caligus dasyaticus"               "Coralliophila tetragona"         
[23] "Triphora alveolata"               "Clavus obliquatus"               
[25] "Naria beckii"                     "Pharaonella rostrata"            
[27] "Lasaea australis"                 "Cadulus rudmani"                 
[29] "Bembicium flavescens"             "Mormula philippiana"             
[31] "Turbonilla tiara"                 "Chlorodiloma crinita"            
[33] "Mitrella merita"                  "Tritonoharpa antiquata"          
[35] "Mauritia depressa dispersa"       "Laevidentalium zeidleri"         
[37] "Conus (Harmoniconus) musicus"     "Marionia cyanobranchiata"        
[39] "Tucetona flabellata"              "Neochromadora bilineata"         
[41] "Desmoscolex membranosus"          "Echeneidocoelium indicum"        
[43] "Indodidymozoon suttiei"           "Diploproctodaeum yosogi"         
[45] "Pseudopecoelus japonicus"         "Pedibothrium lloydae"            
[47] "Amphitethya stipitata"            "Pseudosuberites mollis"          
[49] "Psammochela psammodes"           
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Resolve names}
\NormalTok{resolved }\OtherTok{\textless{}{-}} \FunctionTok{gnr\_resolve}\NormalTok{(}\FunctionTok{unique}\NormalTok{(afd}\SpecialCharTok{$}\NormalTok{VALID\_NAME), }\AttributeTok{best\_match\_only =} \ConstantTok{TRUE}\NormalTok{) }
\NormalTok{resolved }\SpecialCharTok{|\textgreater{}} \FunctionTok{print}\NormalTok{(}\AttributeTok{n =} \DecValTok{50}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 49 x 5
   user_supplied_name        submitted_name matched_name data_source_title score
 * <chr>                     <chr>          <chr>        <chr>             <dbl>
 1 Prosphaerosyllis battiri  Prosphaerosyl~ Prosphaeros~ National Center ~ 0.988
 2 Clavellopsis parasargi    Clavellopsis ~ Clavellopsi~ uBio NameBank     0.988
 3 Platypontonia hyotis      Platypontonia~ Platyponton~ National Center ~ 0.988
 4 Palirhoeus eatoni         Palirhoeus ea~ Palirhoeus ~ Wikispecies       0.988
 5 Diastylis kapalae         Diastylis kap~ Diastylis k~ Encyclopedia of ~ 0.988
 6 Xenobates chinai          Xenobates chi~ Xenobates c~ Encyclopedia of ~ 0.988
 7 Paratanais gaspodei       Paratanais ga~ Paratanais ~ Wikispecies       0.988
 8 Paradexamine flindersi    Paradexamine ~ Paradexamin~ Encyclopedia of ~ 0.988
 9 Prostebbingia brevicornis Prostebbingia~ Prostebbing~ Encyclopedia of ~ 0.988
10 Cythere lactea            Cythere lactea Cythere lac~ Encyclopedia of ~ 0.988
11 Cythere melobesioides     Cythere melob~ Cythere mel~ Encyclopedia of ~ 0.988
12 Achelia transfugoides     Achelia trans~ Achelia tra~ National Center ~ 0.988
13 Halobates (Halobates) ac~ Halobates (ha~ Halobates (~ CU*STAR           0.999
14 Quadraceps hopkinsi apop~ Quadraceps ho~ Quadraceps ~ Catalogue of Lif~ 0.999
15 Anabarhynchus striatus    Anabarhynchus~ Anabarhynch~ Encyclopedia of ~ 0.988
16 Australocytheridea vande~ Australocythe~ Australocyt~ Encyclopedia of ~ 0.988
17 Enigmaplax littoralis     Enigmaplax li~ Enigmaplax ~ Encyclopedia of ~ 0.988
18 Hyphalus insularis        Hyphalus insu~ Hyphalus in~ Wikispecies       0.988
19 Plesiopenaeus armatus     Plesiopenaeus~ Plesiopenae~ Wikispecies       0.988
20 Uroptychus brucei         Uroptychus br~ Uroptychus ~ Wikispecies       0.988
21 Caligus dasyaticus        Caligus dasya~ Caligus das~ Encyclopedia of ~ 0.988
22 Coralliophila tetragona   Coralliophila~ Coralliophi~ Encyclopedia of ~ 0.988
23 Triphora alveolata        Triphora alve~ Triphora al~ uBio NameBank     0.988
24 Clavus obliquatus         Clavus obliqu~ Clavus obli~ Encyclopedia of ~ 0.988
25 Naria beckii              Naria beckii   Naria beckii National Center ~ 0.988
26 Pharaonella rostrata      Pharaonella r~ Pharaonella~ Arctos            0.988
27 Lasaea australis          Lasaea austra~ Lasaea aust~ National Center ~ 0.988
28 Cadulus rudmani           Cadulus rudma~ Cadulus rud~ Encyclopedia of ~ 0.988
29 Bembicium flavescens      Bembicium fla~ Bembicium f~ National Center ~ 0.988
30 Mormula philippiana       Mormula phili~ Mormula phi~ Encyclopedia of ~ 0.988
31 Turbonilla tiara          Turbonilla ti~ Turbonilla ~ Encyclopedia of ~ 0.988
32 Chlorodiloma crinita      Chlorodiloma ~ Chlorodilom~ National Center ~ 0.988
33 Mitrella merita           Mitrella meri~ Mitrella me~ Encyclopedia of ~ 0.988
34 Tritonoharpa antiquata    Tritonoharpa ~ Tritonoharp~ National Center ~ 0.988
35 Mauritia depressa disper~ Mauritia depr~ Mauritia de~ National Center ~ 0.999
36 Laevidentalium zeidleri   Laevidentaliu~ Laevidental~ Encyclopedia of ~ 0.988
37 Conus (Harmoniconus) mus~ Conus (harmon~ Conus Linna~ Catalogue of Lif~ 0.75 
38 Marionia cyanobranchiata  Marionia cyan~ Marionia cy~ National Center ~ 0.988
39 Tucetona flabellata       Tucetona flab~ Tucetona fl~ Encyclopedia of ~ 0.988
40 Neochromadora bilineata   Neochromadora~ Neochromado~ National Center ~ 0.988
41 Desmoscolex membranosus   Desmoscolex m~ Desmoscolex~ Encyclopedia of ~ 0.988
42 Echeneidocoelium indicum  Echeneidocoel~ Echeneidoco~ Integrated Taxon~ 0.988
43 Indodidymozoon suttiei    Indodidymozoo~ Indodidymoz~ National Center ~ 0.988
44 Diploproctodaeum yosogi   Diploproctoda~ Diploprocto~ Encyclopedia of ~ 0.988
45 Pseudopecoelus japonicus  Pseudopecoelu~ Pseudopecoe~ Integrated Taxon~ 0.988
46 Pedibothrium lloydae      Pedibothrium ~ Pedibothriu~ Encyclopedia of ~ 0.988
47 Amphitethya stipitata     Amphitethya s~ Amphitethya~ Wikispecies       0.988
48 Pseudosuberites mollis    Pseudosuberit~ Pseudosuber~ Encyclopedia of ~ 0.988
49 Psammochela psammodes     Psammochela p~ Psammochela~ Wikispecies       0.988
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Retrieve synonyms}
\NormalTok{tsn }\OtherTok{\textless{}{-}} \FunctionTok{get\_tsn}\NormalTok{(}\FunctionTok{unique}\NormalTok{(afd}\SpecialCharTok{$}\NormalTok{VALID\_NAME)[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
==  5 queries  ===============
✖  Not Found:  Prosphaerosyllis battiri
✖  Not Found:  Clavellopsis parasargi
✔  Found:  Platypontonia hyotis
✖  Not Found:  Palirhoeus eatoni
✖  Not Found:  Diastylis kapalae
==  Results  =================

• Total: 5 
• Found: 1 
• Not Found: 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{synonyms}\NormalTok{(tsn)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$<NA>
[1] NA

$<NA>
[1] NA

$`612530`
  sub_tsn acc_tsn   syn_author                  syn_name syn_tsn
1  612530  612530 Suzuki, 1971 Platypontonia pterostreae 1191962

$<NA>
[1] NA

$<NA>
[1] NA
\end{verbatim}

\hypertarget{input-from-experts}{%
\section{Input from experts}\label{input-from-experts}}

Programmatic solutions for resolving synonymy can only go so far.
Seeking validation from experts is sensible if your goal is to obtain a
high quality species list. Museums or taxonomic societies are extensive
sources of knowledge. Below we have provided a list of some of
Australian taxonomic society groups.

\hypertarget{australian-taxonomic-society-groups}{%
\subsection{Australian taxonomic society
groups}\label{australian-taxonomic-society-groups}}

\textbf{VERTEBRATES}

\begin{itemize}
\tightlist
\item
  Amphibians and reptiles - \href{https://ahs.org.au/}{Australian
  Herpetological Society}\\
\item
  Birds - \href{https://www.birdlife.org.au/}{Birdlife Australia}\\
\item
  Fish - \href{https://www.asfb.org.au/}{Australian Society for Fish
  Biology}\\
\item
  Mammals - \href{https://australianmammals.org.au/}{The Australian
  Mammal Society}
\end{itemize}

\textbf{INVERTEBRATES}

\begin{itemize}
\tightlist
\item
  Arachnology -
  \href{www.australasianarachnologicalsociety.org}{Australasian
  Arachnological Society}\\
\item
  Entomology - \href{https://www.austentsoc.org.au/}{Australian
  Entomological Society}\\
\item
  Malacology - \href{https://www.malsocaus.org/}{The Malacological
  Society of Australasia}\\
\item
  Nematology - \href{https://www.nematologists.org.au/}{Australasian
  Association of Nematologists}
\end{itemize}

\hypertarget{global-taxonomy}{%
\subsection{Global taxonomy}\label{global-taxonomy}}

\begin{itemize}
\item
  GBIF uses 100 different sources to assemble -
  \href{https://www.gbif.org/dataset/d7dddbf4-2cf0-4f39-9b2a-bb099caae36c}{their
  global taxonomic backbone}
\item
  Authoritative taxonomic information on plants, animals, fungi, and
  microbes - \href{https://www.itis.gov/}{Integrated Taxonomic
  Information System, ITIS}
\item
  Global taxonomic catalogue
\item
  \href{https://www.catalogueoflife.org/}{Catalogue of Life}
\end{itemize}

\bookmarksetup{startatroot}

\hypertarget{taxonomy-ii}{%
\chapter{Taxonomy II}\label{taxonomy-ii}}

\hypertarget{joining-datasets-from-different-infrastructures}{%
\section{Joining datasets from different
infrastructures}\label{joining-datasets-from-different-infrastructures}}

If you have downloaded data from different sources, you likely will need
to collate your data into a singular database. It is important to make
sure fields that have the same, are indeed the same variable, so prior
to merging - take the time cross check the meta-data from different data
providers (Ribeiro et al. 2022).

\hypertarget{variable-names-and-case-format}{%
\subsection{Variable names and case
format}\label{variable-names-and-case-format}}

Data providers will have their own naming conventions for variables. For
example, World Register of Marine Species uses a combination of lower
case e.g scientific\_name and camel case e.g isExtinct. While the naming
authority - Australian Fauna Directory (AFD) uses upper, snake case
e.g.~SCIENTIFIC\_NAME. What format you choose is a matter of personal
preference, the key is to be consistent.

Here we will subset the variables we want, reformat them to the lower
snake case names and then join by \texttt{VALID\_NAME}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}

\NormalTok{habitat\_data }\OtherTok{\textless{}{-}}\NormalTok{ worms }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(valid\_name, }\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"is"}\NormalTok{)) }

\FunctionTok{names}\NormalTok{(habitat\_data)[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{] }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "isMarine"      "isBrackish"    "isFreshwater"  "isTerrestrial"
[5] "isExtinct"    
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new\_names }\OtherTok{\textless{}{-}} \FunctionTok{str\_split}\NormalTok{(}\FunctionTok{names}\NormalTok{(habitat\_data)[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{], }\AttributeTok{pattern =}  \StringTok{"(?\textless{}=[a{-}z])(?=[A{-}Z])"}\NormalTok{, }\AttributeTok{n =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}  \CommentTok{\# Seperate where case cases from lower to upper i.e. camel case}
  \FunctionTok{map}\NormalTok{(}\AttributeTok{.x =}\NormalTok{ ., }
      \AttributeTok{.f =} \SpecialCharTok{\textasciitilde{}}\FunctionTok{tolower}\NormalTok{(.x)) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# Convert to all lower case}
    \FunctionTok{map}\NormalTok{(}\AttributeTok{.x =}\NormalTok{ ., }
      \AttributeTok{.f =} \SpecialCharTok{\textasciitilde{}}\FunctionTok{str\_flatten}\NormalTok{(.x, }\StringTok{"\_"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}  \CommentTok{\# Bind the two seperated elements}
  \FunctionTok{unlist}\NormalTok{()}
  
\NormalTok{new\_names}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "is_marine"      "is_brackish"    "is_freshwater"  "is_terrestrial"
[5] "is_extinct"    
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Replace old with new}
\FunctionTok{names}\NormalTok{(habitat\_data)[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ new\_names}

\CommentTok{\# Join habitat data by VALID\_NAME}
\NormalTok{afd }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{left\_join}\NormalTok{(habitat\_data, }\AttributeTok{by =} \FunctionTok{join\_by}\NormalTok{(VALID\_NAME }\SpecialCharTok{==}\NormalTok{ valid\_name))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 49 x 37
   GROUP_NAME HIGHER_CLASSIFICATION    KINGDOM PHYLUM SUBPHYLUM SUPERCLASS CLASS
   <chr>      <chr>                    <chr>   <chr>  <chr>     <lgl>      <chr>
 1 ANNELIDA   Phylum ANNELIDA, Class ~ ANIMAL~ ANNEL~ <NA>      NA         POLY~
 2 ARTHROPODA Phylum ARTHROPODA, Subp~ ANIMAL~ ARTHR~ CRUSTACEA NA         MAXI~
 3 ARTHROPODA Phylum ARTHROPODA, Subp~ ANIMAL~ ARTHR~ CRUSTACEA NA         MALA~
 4 ARTHROPODA Phylum ARTHROPODA, Subp~ ANIMAL~ ARTHR~ HEXAPODA  NA         INSE~
 5 ARTHROPODA Phylum ARTHROPODA, Subp~ ANIMAL~ ARTHR~ CRUSTACEA NA         MALA~
 6 ARTHROPODA Phylum ARTHROPODA, Subp~ ANIMAL~ ARTHR~ HEXAPODA  NA         INSE~
 7 ARTHROPODA Phylum ARTHROPODA, Subp~ ANIMAL~ ARTHR~ CRUSTACEA NA         MALA~
 8 ARTHROPODA Phylum ARTHROPODA, Subp~ ANIMAL~ ARTHR~ CRUSTACEA NA         MALA~
 9 ARTHROPODA Phylum ARTHROPODA, Subp~ ANIMAL~ ARTHR~ CRUSTACEA NA         MALA~
10 ARTHROPODA Phylum ARTHROPODA, Subp~ ANIMAL~ ARTHR~ CRUSTACEA NA         OSTR~
# i 39 more rows
# i 30 more variables: SUBCLASS <chr>, SUPERORDER <chr>, ORDER <chr>,
#   SUBORDER <chr>, SUPERFAMILY <chr>, FAMILY <chr>, SUBFAMILY <chr>,
#   SUPERTRIBE <lgl>, TRIBE <chr>, SUBTRIBE <lgl>, GENUS <chr>,
#   SUB_GENUS <chr>, SPECIES <chr>, SUB_SPECIES <chr>, AUTHOR <chr>,
#   YEAR <dbl>, CHANGED_COMBINATION <chr>, VALID_NAME <chr>,
#   COMPLETE_NAME <chr>, SYNONYMS <chr>, CHANGED_COMB_NAMES <chr>, ...
\end{verbatim}

One issue you might face is that higher taxonomy from different
providers may not match. If this is the case, we suggest choosing the
data provider with the higher taxonomy that is consistent with your
naming authority and use it to back fill the higher taxonomy of the
other data sources

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{higher\_taxonomy }\OtherTok{\textless{}{-}}\NormalTok{ inverts }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(scientificName) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{distinct}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{search\_taxa}\NormalTok{()}

\NormalTok{higher\_taxonomy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 36 x 15
   search_term     scientific_name scientific_name_auth~1 taxon_concept_id rank 
   <chr>           <chr>           <chr>                  <chr>            <chr>
 1 Palirhoeus eat~ Palirhoeus eat~ (C.O. Waterhouse, 187~ https://biodive~ spec~
 2 Lasaea austral~ Lasaea austral~ (Lamarck, 1818)        https://biodive~ spec~
 3 Turbonilla tia~ Turbonilla tia~ May, 1911              https://biodive~ spec~
 4 Tucetona flabe~ Tucetona flabe~ (Tenison-Woods, 1878)  https://biodive~ spec~
 5 Achelia transf~ Achelia transf~ Stock, 1973            https://biodive~ spec~
 6 Coralliophila ~ Coralliophila ~ Kosuge, 1986           https://biodive~ spec~
 7 Amphitethya st~ Amphitethya st~ (Carter, 1886)         https://biodive~ spec~
 8 Australocyther~ Australocyther~ McKenzie, 1967         https://biodive~ spec~
 9 Plesiopenaeus ~ Plesiopenaeus ~ (Spence Bate, 1881)    https://biodive~ spec~
10 Chlorodiloma c~ Chlorodiloma c~ (Philippi, 1849)       https://biodive~ spec~
# i 26 more rows
# i abbreviated name: 1: scientific_name_authorship
# i 10 more variables: match_type <chr>, kingdom <chr>, phylum <chr>,
#   class <chr>, order <chr>, family <chr>, genus <chr>, species <chr>,
#   issues <chr>, vernacular_name <chr>
\end{verbatim}

Remember to always check your changes after!

\hypertarget{extended-taxonomic-cleaning}{%
\section{Extended taxonomic
cleaning}\label{extended-taxonomic-cleaning}}

Depending on your project's data scope, it may be necessary to remove
certain groups of taxa. Below, we have provided a few examples. We will
also briefly showcase \texttt{CoordinateCleaner} a useful R package for
removing XX records.

\hypertarget{introduced-or-invasive-species}{%
\subsection{Introduced or Invasive
species}\label{introduced-or-invasive-species}}

Remove non-native species: This step is a common requirement. A list can
be obtained from the \href{https://griis.org/download}{Global Register
of Introduced and Invasive Species (GRIIS)}. The downloads are sorted my
country. Once this list is read into R, you can proceed to exclude
invasive species from your data as below:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(here)}

\NormalTok{griis\_ls }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data/lists/GRIIS\_Australia\_20230331{-}121730.csv"}\NormalTok{))}

\FunctionTok{glimpse}\NormalTok{(griis\_ls)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Rows: 2,979
Columns: 16
$ scientific_name                  <chr> "Oenothera longiflora L.", "Lampranth~
$ scientific_name_type             <chr> "species", "species", "species", "spe~
$ kingdom                          <chr> "Plantae", "Plantae", "Plantae", "Pla~
$ establishment_means              <chr> "alien", "alien", "alien", "alien", "~
$ is_invasive                      <chr> "null", "null", "null", "null", "null~
$ occurrence_status                <chr> "present", "present", "present", "pre~
$ checklist.name                   <chr> "Australia", "Australia", "Australia"~
$ checklist.iso_countrycode_alpha3 <chr> "AUS", "AUS", "AUS", "AUS", "AUS", "A~
$ accepted_name.species            <chr> "Oenothera longiflora", "Lampranthus ~
$ accepted_name.kingdom            <chr> "Plantae", "Plantae", "Plantae", "Pla~
$ accepted_name.phylum             <chr> "Tracheophyta", "Tracheophyta", "Trac~
$ accepted_name.class              <chr> "Magnoliopsida", "Magnoliopsida", "Ma~
$ accepted_name.order              <chr> "Myrtales", "Caryophyllales", "Erical~
$ accepted_name.family             <chr> "Onagraceae", "Aizoaceae", "Ericaceae~
$ accepted_name.habitat            <chr> "[\"terrestrial\"]", "[\"terrestrial\~
$ accepted_name                    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note which species matched with GRIIS list}
\NormalTok{matches }\OtherTok{\textless{}{-}}\NormalTok{ plants }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(scientific\_name }\SpecialCharTok{\%in\%}\NormalTok{ griis\_ls}\SpecialCharTok{$}\NormalTok{accepted\_name.species)}
\NormalTok{matches}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2 x 13
  record_id    scientific_name vernacular_name kingdom phylum class order family
  <chr>        <chr>           <chr>           <chr>   <chr>  <chr> <chr> <chr> 
1 94df1223-4c~ Lysimachia jap~ Creeping Loose~ Plantae Trach~ Magn~ Eric~ Primu~
2 8055e15e-36~ Lysimachia jap~ Creeping Loose~ Plantae Trach~ Magn~ Eric~ Primu~
# i 5 more variables: genus <chr>, species <chr>, subspecies <chr>,
#   latitude <dbl>, longitude <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Exclude GRIIS matches}
\NormalTok{plants\_no\_griis }\OtherTok{\textless{}{-}}\NormalTok{ plants }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\NormalTok{ scientific\_name }\SpecialCharTok{\%in\%}\NormalTok{ matches)}
\end{Highlighting}
\end{Shaded}

\hypertarget{extinct-species}{%
\subsection{Extinct species}\label{extinct-species}}

In most cases, a year filter during in your download query should remove
\emph{most} extinct species.

You want to cross check for extinct species using the Interim Register
of Marine and Nonmarine Genera \href{https://www.irmng.org/}{(IRMNG)}.
The list is comprehensive and actively maintained, the only caveat is
that a lot of its data doesn't go down to species level. As such, we
recommend using the following approach to find \emph{potentially
extinct} taxa and further investigate the records that we are flagged.

The required files are organised by year and can be downloaded from
\href{https://www.irmng.org/export/}{here}. Once you have unzipped the
file in your projected directory, we need to process the list a
littlerbefore we use it to exclude extinct species.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(data.table)}
\FunctionTok{library}\NormalTok{(janitor)}

\CommentTok{\# Taxonomic info}
\NormalTok{irmng\_taxa }\OtherTok{\textless{}{-}} \FunctionTok{fread}\NormalTok{(}\StringTok{"data/lists/IRMNG\_genera\_DwCA\_2023{-}05{-}19/taxon.txt"}\NormalTok{, }\AttributeTok{na.strings =} \FunctionTok{c}\NormalTok{(}\StringTok{""}\NormalTok{), }\AttributeTok{quote=}\StringTok{""}\NormalTok{)}

\CommentTok{\# Species profile}
\NormalTok{irmng\_sp }\OtherTok{\textless{}{-}} \FunctionTok{fread}\NormalTok{(}\StringTok{"data/lists/IRMNG\_genera\_DwCA\_2023{-}05{-}19/speciesprofile.txt"}\NormalTok{, }\AttributeTok{na.strings =} \FunctionTok{c}\NormalTok{(}\StringTok{""}\NormalTok{), }\AttributeTok{quote=}\StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Precleaning }
\NormalTok{awc\_pattern }\OtherTok{\textless{}{-}} \StringTok{"(awaiting allocation)"}
\NormalTok{insed\_pattern }\OtherTok{\textless{}{-}} \StringTok{"incertae sedis"}

\NormalTok{cleaned\_irmng\_taxa }\OtherTok{\textless{}{-}}\NormalTok{ irmng\_taxa }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{class =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(class, }\AttributeTok{pattern =} \FunctionTok{paste0}\NormalTok{(awc\_pattern,}\StringTok{"|"}\NormalTok{, insed\_pattern)),}
                        \FunctionTok{word}\NormalTok{(class), class) }\CommentTok{\# Remove pesky values}
\NormalTok{         ) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(taxonomicStatus }\SpecialCharTok{==} \StringTok{"accepted"}\NormalTok{) }\SpecialCharTok{|\textgreater{}} \CommentTok{\# Filter to accepted names }
  \FunctionTok{filter}\NormalTok{(kingdom }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Animalia"}\NormalTok{, }\StringTok{"Plantae"}\NormalTok{),}
         \SpecialCharTok{!}\NormalTok{ kingdom }\SpecialCharTok{==} \StringTok{"Questionable / non{-}biota (fossil)"}\NormalTok{) }\CommentTok{\# Filter to Animal and plants {-} change if working with other kingdoms}

\CommentTok{\# Join with species profile, remove pesky values and filter to extinct taxa }
\NormalTok{extinct\_irmng }\OtherTok{\textless{}{-}}\NormalTok{ irmng\_taxa }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{left\_join}\NormalTok{(irmng\_sp, }\AttributeTok{by =} \StringTok{"taxonID"}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\NormalTok{ scientificName }\SpecialCharTok{==} \StringTok{"Questionable / non{-}biota (fossil)"}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(isExtinct }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{) }

\CommentTok{\# Summary of extinct species by taxonRank}
\NormalTok{extinct\_irmng}\SpecialCharTok{$}\NormalTok{taxonRank }\SpecialCharTok{|\textgreater{}} \FunctionTok{tabyl}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 extinct_irmng$taxonRank     n      percent
                   Class    14 5.926177e-04
                  Family  1675 7.090247e-02
                   Genus 21718 9.193193e-01
              Infraclass     1 4.232983e-05
                   Order   210 8.889265e-03
                  Phylum     4 1.693193e-04
                Subclass     2 8.465967e-05
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create genus }
\NormalTok{inverts }\OtherTok{\textless{}{-}}\NormalTok{ inverts }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{genus =} \FunctionTok{word}\NormalTok{(scientificName, }\DecValTok{1}\NormalTok{)) }

\CommentTok{\# Extract unique extinct genus and remove genus that have punctuation in them}
\NormalTok{extinct\_genus }\OtherTok{\textless{}{-}}\NormalTok{ extinct\_irmng }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{drop\_na}\NormalTok{(genus) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{str\_detect}\NormalTok{(genus, }\AttributeTok{pattern =} \FunctionTok{regex}\NormalTok{(}\StringTok{"[:punct:]"}\NormalTok{))) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{pull}\NormalTok{(genus) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{unique}\NormalTok{() }
 
\CommentTok{\# Check if there are any matches at genus level}
\NormalTok{check }\OtherTok{\textless{}{-}}\NormalTok{ inverts }\SpecialCharTok{|\textgreater{}} 
\FunctionTok{filter}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(genus, }\AttributeTok{pattern =} \FunctionTok{regex}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(extinct\_genus, }\AttributeTok{collapse=}\StringTok{"|"}\NormalTok{)))) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{pull}\NormalTok{(scientificName) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{unique}\NormalTok{() }

\NormalTok{check}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Halobates (Halobates) acherontis"
\end{verbatim}

Alternatively, you can use the IUCN to retrieve a list of extinct
species that are in their database

https://apiv3.iucnredlist.org/api/v3/docs\#species-category
https://docs.ropensci.org/crul/articles/crul.html

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rredlist)}
\FunctionTok{library}\NormalTok{(skimr)}

\CommentTok{\# Create IUCN token}
\NormalTok{rredlist}\SpecialCharTok{::}\FunctionTok{rl\_use\_iucn}\NormalTok{() }\CommentTok{\# Application can take a day or two!}
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{edit\_r\_environ}\NormalTok{() }\CommentTok{\# Place the approved token in your R environment}

\NormalTok{extinct\_iucn }\OtherTok{\textless{}{-}} \FunctionTok{rl\_sp\_category}\NormalTok{(}\StringTok{\textquotesingle{}EX\textquotesingle{}}\NormalTok{)}
\FunctionTok{skim}\NormalTok{(extinct\_iucn)}

\NormalTok{extinct\_sp }\OtherTok{\textless{}{-}}\NormalTok{ extinct\_iucn}\SpecialCharTok{$}\NormalTok{result }\SpecialCharTok{|\textgreater{}} \FunctionTok{tibble}\NormalTok{() }\CommentTok{\# Note these are extinct species across the globe}

\CommentTok{\# Find matches}
\NormalTok{inverts }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(scientificName }\SpecialCharTok{\%in\%}\NormalTok{ extinct\_sp}\SpecialCharTok{$}\NormalTok{scientific\_name) }\CommentTok{\# No matches}
\end{Highlighting}
\end{Shaded}

\hypertarget{certain-lifestges}{%
\subsection{Certain lifestges}\label{certain-lifestges}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(galah)}
\FunctionTok{library}\NormalTok{(skimr)}

\FunctionTok{galah\_config}\NormalTok{(}\AttributeTok{email =} \FunctionTok{Sys.getenv}\NormalTok{(}\StringTok{"ALA\_EMAIL"}\NormalTok{),}
             \AttributeTok{atlas =} \StringTok{"Australia"}\NormalTok{)}

\NormalTok{bilby }\OtherTok{\textless{}{-}} \FunctionTok{galah\_call}\NormalTok{() }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{galah\_identify}\NormalTok{(}\StringTok{"Macrotis lagotis"}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{galah\_filter}\NormalTok{(year }\SpecialCharTok{==} \DecValTok{2022}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{galah\_select}\NormalTok{(}\AttributeTok{group =} \StringTok{"basic"}\NormalTok{, sex, lifeStage, reproductiveCondition) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{atlas\_occurrences}\NormalTok{()}

\NormalTok{bilby }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\NormalTok{sex }\SpecialCharTok{==} \StringTok{"MALE"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 35 x 11
   decimalLatitude decimalLongitude eventDate           scientificName  
             <dbl>            <dbl> <dttm>              <chr>           
 1           -34.2             143. 2022-06-16 14:00:00 Macrotis lagotis
 2           -34.2             143. 2022-06-14 14:00:00 Macrotis lagotis
 3           -34.2             143. 2022-03-22 13:00:00 Macrotis lagotis
 4           -34.2             143. 2022-03-22 13:00:00 Macrotis lagotis
 5           -34.2             143. 2022-03-22 13:00:00 Macrotis lagotis
 6           -34.2             143. 2022-03-23 13:00:00 Macrotis lagotis
 7           -34.2             143. 2022-03-21 13:00:00 Macrotis lagotis
 8           -34.2             143. 2022-06-12 14:00:00 Macrotis lagotis
 9           -34.2             143. 2022-03-23 13:00:00 Macrotis lagotis
10           -34.2             143. 2022-06-12 14:00:00 Macrotis lagotis
# i 25 more rows
# i 7 more variables: taxonConceptID <chr>, recordID <chr>,
#   dataResourceName <chr>, occurrenceStatus <chr>, sex <chr>, lifeStage <lgl>,
#   reproductiveCondition <chr>
\end{verbatim}

\hypertarget{marine-species}{%
\subsection{Marine species}\label{marine-species}}

Remove specific taxa/ depending on the study: For example, if working
with terrestrial data, it is necessary to remove marine taxa.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(worrms)}

\CommentTok{\# Obtain species list}
\NormalTok{my\_species }\OtherTok{\textless{}{-}}\NormalTok{ inverts }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{pull}\NormalTok{(scientificName) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{unique}\NormalTok{()}

\CommentTok{\# Query WoRMs}
\NormalTok{marine\_check }\OtherTok{\textless{}{-}} \FunctionTok{map\_dfr}\NormalTok{(my\_species,}
       \FunctionTok{possibly}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{worrms}\SpecialCharTok{::}\FunctionTok{wm\_records\_name}\NormalTok{(}\AttributeTok{name =}\NormalTok{ .x) }\SpecialCharTok{|\textgreater{}} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{search\_term =}\NormalTok{ .x))}
\NormalTok{)}

\CommentTok{\# Filter species that are TRUE for isMarine}
\NormalTok{marine\_inverts }\OtherTok{\textless{}{-}}\NormalTok{ marine\_check }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(isMarine }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{select}\NormalTok{(search\_term)}

\CommentTok{\# Exclude marine invertebrates}
\NormalTok{inverts }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\NormalTok{scientificName }\SpecialCharTok{\%in\%}\NormalTok{ marine\_inverts)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 2,637 x 9
   decimalLatitude decimalLongitude eventDate           scientificName   
             <dbl>            <dbl> <dttm>              <chr>            
 1           -46.9             37.8 1983-04-01 00:00:00 Palirhoeus eatoni
 2           -46.9             37.8 1984-09-01 00:00:00 Palirhoeus eatoni
 3           -46.9             37.9 1986-04-01 00:00:00 Palirhoeus eatoni
 4           -46.6             38.0 1985-04-01 00:00:00 Palirhoeus eatoni
 5           -46.6             38.0 1983-05-01 00:00:00 Palirhoeus eatoni
 6           -46.6             38.0 1984-09-01 00:00:00 Palirhoeus eatoni
 7           -46.6             38.0 1984-04-01 00:00:00 Palirhoeus eatoni
 8           -43.6            148.  NA                  Lasaea australis 
 9           -43.6            147.  2008-12-28 00:00:00 Lasaea australis 
10           -43.6            147.  2008-12-28 00:00:00 Lasaea australis 
# i 2,627 more rows
# i 5 more variables: taxonConceptID <chr>, recordID <chr>,
#   dataResourceName <chr>, occurrenceStatus <chr>, genus <chr>
\end{verbatim}

\bookmarksetup{startatroot}

\hypertarget{sec-spatial}{%
\chapter{Spatial data}\label{sec-spatial}}

You've been through the taxonomic cleaning steps so now it's time to
clean up the spatial element. You may have flagged records as being
taxonomically incorrect, it's important to keep those in mind as you go
through the spatial cleaning steps as you might learn more about those
records. We will discuss some different ways to check for spatial
outliers as well as the removal of records in certain geographic areas
known to be problematic.

\hypertarget{quick-visualisation}{%
\section{Quick visualisation}\label{quick-visualisation}}

One of the most straightforward ways to check for spatial errors is to
plot your data onto a map. More obvious spatial errors are much easier
to spot visually.

\hypertarget{coordinate-precision}{%
\section{Coordinate precision}\label{coordinate-precision}}

Data from different sources are collected by different people often
using differing tools. For example, some might record coordinates with a
tool with high precision like a phone or a GPS, whereas others might
record coordinates with low precision by manually recording a place name
or writing coordinates after the fact.

Depending on the level of precision to answer your research question,
you might consider discarding data of lower precision, or removing
decimal places for data you know could not be that precise. At the ALA
there is a ``cooridnateprecision''/ ``coordinateUncertainityIn Meters''
assertion (\ul{see assertion section to download these with the data)}

\includegraphics{images/image-613988507.png}

https://xkcd.wtf/2170/

Coordinate precision below 100km represents the grain size of many
macroecological analyses (Zizka et al. 2020b). Some studies have used a
cut-off of spatial resolution \textgreater25,000m or precision with less
than three decimal places (\textbf{add a reference here}). It is
important to note that rasterized collections often have a significant
proportion of records that might have low coordinate precision.
Understanding the level of quality you need is important before
removing/keeping large volumes of data.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#How to filter by number of decimal places}
\end{Highlighting}
\end{Shaded}

\hypertarget{coordinate-correction}{%
\section{Coordinate correction}\label{coordinate-correction}}

Some of these steps may have been completed in a pre-cleaning step,
however it's now time to be more rigorous. As always we'll start with
fixing data before discarding, many coordinates issues can be solved
with data manipulation instead of discarding:

\textbf{Flipped coordinates:} Flipped coordinates typically appear as a
clustering of points, whereby swapping the latitude and longitude will
place the coordinates where they are expected. (Jin and Yang 2020b)

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#example map of some flipped coordinates (what to look for) }
\CommentTok{\# https://www.gbif.org/occurrence/3013406216 this has flipped coordinates, which GBIF has corrected}
\CommentTok{\# https://www.gbif.org/occurrence/search?q=mammalia\&continent=SOUTH\_AMERICA\&has\_coordinate=true\&has\_geospatial\_issue=false\&issue=PRESUMED\_SWAPPED\_COORDINATE\&advanced=1. \#\# the issue and flag is called \textquotesingle{}presumed swapped coordinate\textquotesingle{} }
\end{Highlighting}
\end{Shaded}

\textbf{Numerical sign confusion:} As with flipped coordinates, if there
is a clustering of points mirrored to another hemisphere, consider
swapping the sign and correct rather than discarding the points.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#example map, like coordinates off the coast of japan}

\CommentTok{\# https://biocache.ala.org.au/occurrences/search?q=lsid\%3Ahttps\%3A\%2F\%2Fid.biodiversity.org.au\%2Ftaxon\%2Fapni\%2F51360942\&qualityProfile=CSDM\&radius=50\&lat=35.66845370835343\&lon=138.9990234375\#tab\_recordsView}

\CommentTok{\# eucs \textless{}{-} galah\_call() \%\textgreater{}\% }
\CommentTok{\#  galah\_identify("Eucalyptus") \%\textgreater{}\%}
\CommentTok{\#  galah\_filter( year == 2005, }
\CommentTok{\#             dataResourceName == "The University of Melbourne Herbarium (MELU) AVH data") \%\textgreater{}\%}
\CommentTok{\#  atlas\_occurrences()}
\end{Highlighting}
\end{Shaded}

\textbf{Country field doesn't match coordinates:} The coordinates could
be wrong or just the country listed.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# this doesnt seem to be very common{-} atleast not in ALA data{-} because there is no neighboring country}
\CommentTok{\# https://biocache.ala.org.au/occurrences/a34fca43{-}9e7c{-}4b37{-}8fe4{-}07cc18369465 Australian coordinates, country listed as Trinidad and Tobago}
\CommentTok{\# https://www.gbif.org/occurrence/search?advanced=true\&continent=SOUTH\_AMERICA\&geometry=POLYGON(({-}78.74961\%20{-}8.25249,{-}76.29838\%20{-}8.25249,{-}76.29838\%20{-}4.74121,{-}78.74961\%20{-}4.74121,{-}78.74961\%20{-}8.25249))\&has\_coordinate=true\&issue=COUNTRY\_MISMATCH\&locale=en\&q=reptilia   \# GBIF example{-} reptiles located in Peru, originally recorded as Ecuador}
\end{Highlighting}
\end{Shaded}

\hypertarget{coordinate-cleaning}{%
\section{Coordinate cleaning}\label{coordinate-cleaning}}

Once you have fixed everything you can, it's time to remove records that
still have errors. This doesn't mean removing all outliers, you must
have more than ``it's far away from the others'' to justify a records
removal.

\textbf{Remove records with null or missing coordinates:} This will be
records missing partial or complete information. Missing values can
cause errors, many analytical tools do not respond well to missing
values. If you can't find the information elsewhere, it's best to remove
it.

\textbf{Remove records where longitude and latitude are equal:} High
likelihood that this is not where the record was recorded and, check
first, however likely will need to remove

\textbf{Remove records with zero coordinates:} When plotting it on a
map, zero coordinates will be found around the point at zero latitudes
and longitudes. These records will not accurately represent their valid
location and must be removed.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#zero coordinates acacia }

\CommentTok{\#https://biocache.ala.org.au/occurrences/search?q=lsid\%3Ahttps\%3A\%2F\%2Fid.biodiversity.org.au\%2Ftaxon\%2Fapni\%2F51382879\&disableAllQualityFilters=true\&qualityProfile=ALA\&fq=spatiallyValid\%3A\%22false\%22\&radius=25\&lat={-}0.024032592068740033\&lon={-}0.06591796875\#tab\_recordsView }
\end{Highlighting}
\end{Shaded}

Remove records plotted away from the known area of distribution of the
species. It is essential to check the metadata to ensure that it is a
data entry error and not a real outlier. In some cases, it's worth
checking the literature before discarding records like these. These can
also be mis-identified species, if you're working with data from many
species, and you find a species point in amongst the environmental
bounds of a similar looking species it might be worth going back to the
original record and taking a closer look. However, if no images exist it
might be difficult to determine if it is a taxonomic or spatial
issue.There are several ways of dealing with this issue, but one option
can be to mask data to remove points from falling off a determined area.
--\textgreater{} unsure about this bit

\textbf{I'm not sure I understand what the above means. But I think in
general for less obvious errors, it's best to suggest that before data
analysis (and honestly, before seeing the data at all), people should
determine whether there is an upper bound to remove coordinates (like a
95\% confidence interval, or within xx km of an accepted expert
distribution). Then run whatever model or test with the complete data
and with the reduced data. If it makes a difference, probably make an
informed decision based on literature of which results to use as the
``main'' findings.}

\textbf{Having written this out, a brief discussion about this rather
than any suggestions is probably all that's in scope for this book}

\textbf{The final decisions depend on the species, research question,
model parameters etc}

\hypertarget{optional-record-removal}{%
\section{Optional record removal}\label{optional-record-removal}}

\textbf{Not sure why the below is optional? I think a lot of national or
global analyses would require some kind of data cleaning for this}

Remove records with coordinates assigned to country and province
centroids: such as Centre of Country, botanic gardens, zoos, country
capitals, biodiversity institutions, urban areas, and gbif headquarters.
In some cases these records will haven actually been recorded at a zoo
for example, in other cases this is often incorrectly georeferenced
records. They can be tricky to spot but there are a few packages that
deal with centroid data. Exploratory visuals can also help support
findings, making it easier to spot clusterings of points.

Centroids are common when records are being assigned from georeferencing
based on vague locality descriptions or from incorrect georeferencing.
Sometimes, records are erroneously entered with the physical location of
the specimen or because they represent individuals from captivity or
horticulture, which were not clearly labeled as such.

In a few cases, zoos and botanic gardens might be where the record was
sighted. However, in this case, it is not naturally occurring and should
be removed. Records in urban areas may not want to be removed by
everyone, but it is essential to note that it could be old data or have
vague locality descriptions.

Remove records outside of the country of interest: In some cases,
records outside the country of origin may be outliers. In other cases,
they may be perfectly valid. It is important to analyze case-by-case and
remove the record if necessary.

\hypertarget{checklist-of-data-standardization}{%
\section{Checklist of data
standardization}\label{checklist-of-data-standardization}}

\bookmarksetup{startatroot}

\hypertarget{notes}{%
\chapter{Notes}\label{notes}}

\hypertarget{missing-data}{%
\section{Missing data}\label{missing-data}}

(I wonder if this is really the place for this or better to just do this
in the Spatial chapter)

\begin{itemize}
\tightlist
\item
  Remove records with no coordinates
\end{itemize}

\hypertarget{quick-visualiations}{%
\section{Quick visualiations}\label{quick-visualiations}}

A graphic plot of your data can be very telling and can help you spot
potential errors that may be due to formatting.

\hypertarget{ggally}{%
\subsection{GGally}\label{ggally}}

A visual inspection of your entire dataset can save time and solve
easy-to-spot errors.

\hypertarget{quick-map}{%
\subsection{Quick map}\label{quick-map}}

(I wonder if this is really the place for this or better to just do this
in the Spatial chapter)

A simple way to visualize your data is to plot it on a map.

\begin{itemize}
\tightlist
\item
  Fix minor coordinates errors, such as inverted or badly formatted
\end{itemize}

\hypertarget{section}{%
\subsection{}\label{section}}

\hypertarget{coordinatecleaner}{%
\subsection{CoordinateCleaner}\label{coordinatecleaner}}

\bookmarksetup{startatroot}

\hypertarget{duplicates}{%
\chapter{Duplicates}\label{duplicates}}

Duplicates add computational burden to your analyses. Some spatial
analyses won't run if duplicates are present as it breaks mathematical
constraints. There are a few different categories of duplicates which
you might encounter when working with open source biodiversity data,
with some being more difficult to work with than others.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  True duplicates = Unique identifier (UID) is the same

  True duplicates can occur for many reasons, often data is sent to the
  state authority it was collected in as well as the authority
  responsible for collecting the data, which is not always the same.
  When this data is aggregated by the ALA for example, they end up with
  multiple copies. These are true duplicates- as in they have the same
  UID, same coordinates, same species. They don't always impact
  modelling. Although they can impact sampling bias and increase
  computational burden for no added benefit so it's best to remove them
  (Jin and Yang 2020a; J. R. Marsh et al. 2022).

  Removing true duplicates where the UID is the same is quite
  straightforward and is a common step before mapping biodiversity data.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#assertions: duplicateType "DIFFERENT\_DATASET"}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\item
  Different UID Same species, same coordinates, yet different year.

  If the UID is different, but the species name is the same and the
  coordinates are the same this could be a couple of different things:

  a) If the year is different, it's likely a true record, indicating
  it's continued presence- this is most likely for plants\ldots there
  are cases where you'll still want to remove the

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#assertions: duplicate\_status "ASSOCIATED"}
\end{Highlighting}
\end{Shaded}

  b) Herbarium duplicates: same year, same collector, however different
  UID and minor differences in locality, coordinate precision. These can
  be more difficult to decipher, and we've called them Herbarium
  duplicates as this is when they most commonly occur. The same specimen
  will sometimes be sent to multiple herbariums, this results in
  different UIDs. Additionally because the data is potentially being
  inputted by different people the discrepancies this causes can make
  them difficult to spot {[}REF bob pers com{]}.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#assertions: duplicateType "DIFFERENT\_DATASET"}
\CommentTok{\#assertions: isDuplicateOf "DIFFERENT\_DATASET"}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\item
  Spatial thinning = records located close to each other

  These records are not duplicates, not the same individual, not in
  exactly the same spot, yet close together. Think about patch of grass,
  this isn't one plant but many all packed tightly together. This adds
  computational burden, especially for large scale biodiversity analyses
  and distribution modelling for many species (Zizka et al. 2020b;
  Kuralt, n.d.). This can also be done to reduce bias associated with
  oversampling at a small number of sites within larger species ranges
  (Godfree et al. 2021).
\end{enumerate}

\bookmarksetup{startatroot}

\hypertarget{outliers}{%
\chapter{Outliers}\label{outliers}}

\#note from meeting with Martin this section might include some alpha
hull examples for how to detect outliers, or how they can skew your
data, in addition to maybe an SDM for outlier detection (Simões and
Peterson 2018) even if we won't be teaching people how to run an SDM

Outliers can be true outliers or data errors, true outliers are not
necessarily to be removed. This could represent mis-identified
specimens, etc

(\#note to double check what i wrote for support article around
inconsistent sampling and open source data)

\begin{itemize}
\item
  Alpha hull (some example species - check cailtin chat history)
\item
  SDM Shandiya?
\item
  Remove records with miss-identified taxonomy: Incorrectly identified
  species, or unrecognized species names compared to a naming authority,
  should be removed.
\end{itemize}

Incorrectly identified specimens can be difficult to identify with open
source biodiversity data. Often these will be picked up by 1) an image
of the species in question which does not match 2) If you notice a
species outside of its geographic range, this could be a true outlier,
it could be a spatial error, or it could be a different species.
(\textbf{see --- for more info})

\bookmarksetup{startatroot}

\hypertarget{sec-references}{%
\chapter{References}\label{sec-references}}

\hypertarget{refs}{}
\begin{CSLReferences}{1}{0}
\leavevmode\vadjust pre{\hypertarget{ref-fuhrding-potschkat_influence_2022}{}}%
Führding-Potschkat, Petra, Holger Kreft, and Stefanie M. Ickert-Bond.
2022. {``Influence of Different Data Cleaning Solutions of
Point-Occurrence Records on Downstream Macroecological Diversity
Models.''} \emph{Ecology and Evolution} 12 (8): e9168.
\url{https://doi.org/10.1002/ece3.9168}.

\leavevmode\vadjust pre{\hypertarget{ref-garraffoni2019integrative}{}}%
Garraffoni, André RS, Thiago Q Araújo, Anete P Lourenço, Loretta Guidi,
and Maria Balsamo. 2019. {``Integrative Taxonomy of a New Redudasys
Species (Gastrotricha: Macrodasyida) Sheds Light on the Invasion of
Fresh Water Habitats by Macrodasyids.''} \emph{Scientific Reports} 9
(1): 2067.

\leavevmode\vadjust pre{\hypertarget{ref-godfree_implications_2021}{}}%
Godfree, Robert C., Nunzio Knerr, Francisco Encinas-Viso, David
Albrecht, David Bush, D. Christine Cargill, Mark Clements, et al. 2021.
{``Implications of the 2019--2020 Megafires for the Biogeography and
Conservation of {Australian} Vegetation.''} \emph{Nature Communications}
12 (1): 1023. \url{https://doi.org/10.1038/s41467-021-21266-5}.

\leavevmode\vadjust pre{\hypertarget{ref-gueta_quantifying_2016}{}}%
Gueta, Tomer, and Yohay Carmel. 2016. {``Quantifying the Value of
User-Level Data Cleaning for Big Data: {A} Case Study Using Mammal
Distribution Models.''} \emph{Ecological Informatics} 34 (July):
139--45. \url{https://doi.org/10.1016/j.ecoinf.2016.06.001}.

\leavevmode\vadjust pre{\hypertarget{ref-jin_bdcleaner_2020}{}}%
Jin, Jing, and Jun Yang. 2020a. {``{BDcleaner}: {A} Workflow for
Cleaning Taxonomic and Geographic Errors in Occurrence Data Archived in
Biodiversity Databases.''} \emph{Global Ecology and Conservation} 21
(March): e00852. \url{https://doi.org/10.1016/j.gecco.2019.e00852}.

\leavevmode\vadjust pre{\hypertarget{ref-jin2020}{}}%
---------. 2020b. {``BDcleaner: A Workflow for Cleaning Taxonomic and
Geographic Errors in Occurrence Data Archived in Biodiversity
Databases.''} \emph{Global Ecology and Conservation} 21 (March): e00852.
\url{https://doi.org/10.1016/j.gecco.2019.e00852}.

\leavevmode\vadjust pre{\hypertarget{ref-kuralt}{}}%
Kuralt, Zan. n.d. {``GBIF Data for Species Distribution Modelling: A
Case Study of Lithobius Erythrocephalus (Chilopoda: Lithobiidae).''}
\url{http://rstudio-pubs-static.s3.amazonaws.com/415459_61fae98ff3984241bd5f7f31da425c98.html}.

\leavevmode\vadjust pre{\hypertarget{ref-mace2004role}{}}%
Mace, Georgina M. 2004. {``The Role of Taxonomy in Species
Conservation.''} \emph{Philosophical Transactions of the Royal Society
of London. Series B: Biological Sciences} 359 (1444): 711--19.

\leavevmode\vadjust pre{\hypertarget{ref-marsh2021}{}}%
Marsh, Jess, Payal Bal, Hannah Fraser, Kate Umbers, Aaron Greenville,
Libby Rumpff, and John Woinarski. 2021. {``Assessment of the Impacts of
the 2019-20 Wildfires of Southern and Eastern Australia on Invertebrate
Species Final Report.''}

\leavevmode\vadjust pre{\hypertarget{ref-marsh_accounting_2022}{}}%
Marsh, Jessica R., Payal Bal, Hannah Fraser, Kate Umbers, Tanya Latty,
Aaron Greenville, Libby Rumpff, and John C. Z. Woinarski. 2022.
{``Accounting for the Neglected: {Invertebrate} Species and the
2019--2020 {Australian} Megafires.''} \emph{Global Ecology and
Biogeography} n/a (n/a). \url{https://doi.org/10.1111/geb.13550}.

\leavevmode\vadjust pre{\hypertarget{ref-ribeiro_bdc_2022}{}}%
Ribeiro, Bruno R., Santiago José Elías Velazco, Karlo Guidoni-Martins,
Geiziane Tessarolo, Lucas Jardim, Steven P. Bachman, and Rafael Loyola.
2022. {``Bdc: {A} Toolkit for Standardizing, Integrating and Cleaning
Biodiversity Data.''} \emph{Methods in Ecology and Evolution} 13 (7):
1421--28. \url{https://doi.org/10.1111/2041-210X.13868}.

\leavevmode\vadjust pre{\hypertarget{ref-rodrigues_species_2022}{}}%
Rodrigues, Arthur Vinicius, Gabriel Nakamura, Vanessa Graziele
Staggemeier, and Leandro Duarte. 2022. {``Species Misidentification
Affects Biodiversity Metrics: {Dealing} with This Issue Using the New
{R} Package {naturaList}.''} \emph{Ecological Informatics} 69 (July):
101625. \url{https://doi.org/10.1016/j.ecoinf.2022.101625}.

\leavevmode\vadjust pre{\hypertarget{ref-rowley2020frogid}{}}%
Rowley, Jodi JL, and Corey T Callaghan. 2020. {``The FrogID Dataset:
Expert-Validated Occurrence Records of Australia's Frogs Collected by
Citizen Scientists.''} \emph{ZooKeys} 912: 139.

\leavevmode\vadjust pre{\hypertarget{ref-simoes2018utility}{}}%
Simões, Marianna VP, and A Townsend Peterson. 2018. {``Utility and
Limitations of Climate-Matching Approaches in Detecting Different Types
of Spatial Errors in Biodiversity Data.''} \emph{Insect Conservation and
Diversity} 11 (5): 407--14.

\leavevmode\vadjust pre{\hypertarget{ref-streamdna_sharing_2020}{}}%
streamdna. 2020. {``Sharing Is {Caring}: {Working} with {Other} People's
{Data}.''}
\url{https://methodsblog.com/2020/09/04/sharing-is-caring-working-with-other-peoples-data/}.

\leavevmode\vadjust pre{\hypertarget{ref-zizka_no_2020}{}}%
Zizka, Alexander, Fernanda Antunes Carvalho, Alice Calvente, Mabel Rocio
Baez-Lizarazo, Andressa Cabral, Jéssica Fernanda Ramos Coelho, Matheus
Colli-Silva, Mariana Ramos Fantinati, Moabe F Fernandes, and Thais
Ferreira-Araújo. 2020a. {``No One-Size-Fits-All Solution to Clean
{GBIF}.''} \emph{PeerJ} 8: e9916.

\leavevmode\vadjust pre{\hypertarget{ref-zizka2020}{}}%
---------. 2020b. {``No One-Size-Fits-All Solution to Clean GBIF.''}
\emph{PeerJ} 8: e9916.

\end{CSLReferences}

\bookmarksetup{startatroot}

\hypertarget{sec-appendix}{%
\chapter{Appendix}\label{sec-appendix}}

We don't claim to be experts in data cleaning, therefore in order to
ensure content for this book was current and relevant we undertook an
informal literature review of both peer reviewed and grey literature.
Key themes searched were:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Cleaning data for species distribution models
\item
  Cleaning open biodiversity data
\item
  Australian and global naming authorities
\item
  R packages for biodiversity data cleaning
\end{enumerate}

As this was not a comprehensive literature review recent papers were
selected first as the R environment is a rapidly evolving space. Methods
sections outlining data cleaning protocols were read and collated into a
database. Papers which were frequently referenced were also chosen for
review in order to not miss older seminal papers. Additionally our
project partners outputs (J. Marsh et al. 2021; Godfree et al. 2021)
have been investigated in detail to understand and streamline their data
cleaning processes. This has included detailed review of their code base
as well as meetings with the authors of the papers to understand their
processes, issues and needs.

All steps for acquiring and cleaning data were then looked at together
in order to understand what were essential steps, versus what was done
in certain use cases. We also investigated the order in which steps were
undertaken with the idea of developing a streamlined workflow. However
the diagrams below show the complexity of this, with data cleaning being
extremely iterative.

\includegraphics{images/complex_workflow.png}
\includegraphics{images/simplified_workflow.png}



\end{document}
