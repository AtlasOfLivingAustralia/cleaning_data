<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ALA Data Cleaning - 3&nbsp; Download occurrence data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./preclean.html" rel="next">
<link href="./scope.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./download-data.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Download occurrence data</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">ALA Data Cleaning</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scope.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data scope</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./download-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Download occurrence data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preclean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Precleaning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./taxonomy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Taxonomy</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./taxonomy-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Taxonomy II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./duplicates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Duplicates</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./outliers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Outliers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Appendix</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#where-to-get-data-from" id="toc-where-to-get-data-from" class="nav-link active" data-scroll-target="#where-to-get-data-from"><span class="header-section-number">3.1</span> Where to get data from</a></li>
  <li><a href="#downloading-data" id="toc-downloading-data" class="nav-link" data-scroll-target="#downloading-data"><span class="header-section-number">3.2</span> Downloading data</a>
  <ul class="collapse">
  <li><a href="#taxonomic-focus" id="toc-taxonomic-focus" class="nav-link" data-scroll-target="#taxonomic-focus"><span class="header-section-number">3.2.1</span> Taxonomic focus</a></li>
  </ul></li>
  <li><a href="#query-with-choosen-naming-authority" id="toc-query-with-choosen-naming-authority" class="nav-link" data-scroll-target="#query-with-choosen-naming-authority"><span class="header-section-number">3.3</span> Query with choosen naming authority</a>
  <ul class="collapse">
  <li><a href="#getting-higher-taxonomy" id="toc-getting-higher-taxonomy" class="nav-link" data-scroll-target="#getting-higher-taxonomy"><span class="header-section-number">3.3.1</span> Getting higher taxonomy</a></li>
  <li><a href="#getting-all-taxonomy-relevant-columns" id="toc-getting-all-taxonomy-relevant-columns" class="nav-link" data-scroll-target="#getting-all-taxonomy-relevant-columns"><span class="header-section-number">3.3.2</span> Getting all taxonomy relevant columns</a></li>
  <li><a href="#spatial-focus" id="toc-spatial-focus" class="nav-link" data-scroll-target="#spatial-focus"><span class="header-section-number">3.3.3</span> Spatial focus</a></li>
  </ul></li>
  <li><a href="#choosing-specific-data-columns" id="toc-choosing-specific-data-columns" class="nav-link" data-scroll-target="#choosing-specific-data-columns"><span class="header-section-number">3.4</span> Choosing specific data columns</a></li>
  <li><a href="#refining-your-data-download" id="toc-refining-your-data-download" class="nav-link" data-scroll-target="#refining-your-data-download"><span class="header-section-number">3.5</span> Refining your data download</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-download-data" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Download occurrence data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Once you have decided on your data scope, we can precede to downloading the data. We will introduce a few common data infrastructures that offer open access biodiversity data and highlight some considerations when choosing one in the context of your data scope. We will then discuss some obstacles when consolidating data from multiple sources and the importance of metadata.</p>
<section id="where-to-get-data-from" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="where-to-get-data-from"><span class="header-section-number">3.1</span> Where to get data from</h2>
<p>The <a href="https://www.gbif.org/">Global Biodiversity Information Facility (GBIF)</a> network consists of a series of ‘node’ organisations who collate biodiversity data from their own countries, with GBIF acting as an overarching organisation to store data from all nodes. Users that are interested in obtaining data that has global coverage may want to download directly from GBIF.</p>
<p>Alternatively, using a <em>regional node</em> may be more relevant if your project is at a smaller scale. For example, the <a href="www.ala.org.au">Atlas of Living Australia (ALA)</a> is the Australian node to GBIF and aggregates data from a broad range of providers such as government initiatives, museums, and universities. Importantly, the ALA uses their own taxonomic system and may vary with other data infrastructures. To find other nodes, check out this <a href="https://www.gbif.org/the-gbif-network">page</a></p>
<p>If your project relates to citizen science then <a href="https://www.inaturalist.org/">iNaturalist</a> may be a good option for accessing crowd-sourced data of species observations.</p>
</section>
<section id="downloading-data" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="downloading-data"><span class="header-section-number">3.2</span> Downloading data</h2>
<section id="taxonomic-focus" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="taxonomic-focus"><span class="header-section-number">3.2.1</span> Taxonomic focus</h3>
</section>
</section>
<section id="query-with-choosen-naming-authority" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="query-with-choosen-naming-authority"><span class="header-section-number">3.3</span> Query with choosen naming authority</h2>
<p>(May go before download data or used after download to refine, improve download)</p>
<p>Now that you’ve chosen a naming authority you can use it to ensure consistency across your data set, but also check you haven’t missed any species data from your download.</p>
<section id="getting-higher-taxonomy" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="getting-higher-taxonomy"><span class="header-section-number">3.3.1</span> Getting higher taxonomy</h3>
<p>Downloading higher taxon data (kingdom:class) and then filtering for what you need, as disparities are less common at higher levels (???? Check with Martin)</p>
</section>
<section id="getting-all-taxonomy-relevant-columns" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="getting-all-taxonomy-relevant-columns"><span class="header-section-number">3.3.2</span> Getting all taxonomy relevant columns</h3>
<p>Include the original name that was recorded by the data provider in your download. This is often referred to as <code>verbatimScientificName</code>. or vernacularname</p>
<ol start="2" type="1">
<li>Include synonyms of the species names you’re interested in your download</li>
</ol>
<p>Many developers have created R packages to interact with each data infrastructures’s API to aid access to biodiversity data. Here are a few examples, we recommend taking a look at each package’s documentation to choose one that suits your project.</p>
<ul>
<li><a href="https://docs.ropensci.org/rgbif/"><code>rgbif</code></a> an interface to GBIF</li>
<li><a href="https://galah.ala.org.au/index.html"><code>galah</code></a> an interface to a number living Atlases, as well as GBIF</li>
<li><a href="https://docs.ropensci.org/rinat/"><code>rinat</code></a> an interface to iNaturalist observations</li>
<li><a href="https://docs.ropensci.org/rebird/"><code>rebird</code></a> an interface with the eBird webservices.</li>
<li><a href="https://docs.ropensci.org/spocc/"><code>spocc</code></a> a R package to query and collect species occurrence data from various sources including <a href="https://github.com/ropensci/rvertnet">VertNet</a>, <a href="http://www.idigbio.org/">iDigBio</a> and others.</li>
</ul>
<p>One benefit of using <code>galah</code> is that enables users to acquire not only species occurrence records but also taxonomic information, or associated media such as images or sounds. Below we have included some code blocks for downloading occurrence data with <code>galah</code> from GBIF and a Spain node.</p>
<section id="gbif-data-via-galah" class="level4" data-number="3.3.2.1">
<h4 data-number="3.3.2.1" class="anchored" data-anchor-id="gbif-data-via-galah"><span class="header-section-number">3.3.2.1</span> GBIF data via <code>galah</code></h4>
<p>First, we have to configure <code>galah</code>. This is where you supply your account credentials and set the atlas to a particular region. See <code>?galah_config</code> for more configuration options. You can <a href="https://docs.ropensci.org/rgbif/articles/gbif_credentials.html">save these credentials</a> in your <code>.Renviron</code> so you don’t have to enter it explicitly in code.</p>
<p>We will be downloading all occurrences for the African Elephant from GBIF. This may take a while as it is around 12,000 records. Once downloaded, you can save the records locally in your desired format. For larger downloads, we recommend saving the data as <code>parquets</code> using <code>arrow::write_parquet</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">galah_config</span>(<span class="at">email =</span> <span class="fu">Sys.getenv</span>(<span class="st">"ALA_EMAIL"</span>),</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">username =</span> <span class="fu">Sys.getenv</span>(<span class="st">"GBIF_USER"</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">password =</span> <span class="fu">Sys.getenv</span>(<span class="st">"GBIF_PWD"</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">atlas =</span> <span class="st">"Global"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>african_ele <span class="ot">&lt;-</span> <span class="fu">galah_call</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">galah_identify</span>(<span class="st">"Loxodonta africana"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">atlas_occurrences</span>()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>arrow<span class="sc">::</span><span class="fu">write_parquet</span>(african_ele, <span class="st">"data/gbif/elephant"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12,537 × 50
      gbifID datasetKey     occurrenceID kingdom phylum class order family genus
 *     &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;
 1 924537719 95f132fe-f762… 73e088f2-f8… Animal… Chord… Mamm… Prob… Eleph… Loxo…
 2 924537718 95f132fe-f762… 73e0ad3c-f8… Animal… Chord… Mamm… Prob… Eleph… Loxo…
 3 924537717 95f132fe-f762… 73f0f6ec-f8… Animal… Chord… Mamm… Prob… Eleph… Loxo…
 4 923926679 50c9509d-22c7… http://www.… Animal… Chord… Mamm… Prob… Eleph… Loxo…
 5 923924124 50c9509d-22c7… http://www.… Animal… Chord… Mamm… Prob… Eleph… Loxo…
 6 922237429 6ac3f774-d9fb… &lt;NA&gt;         Animal… Chord… Mamm… Prob… Eleph… Loxo…
 7 922237412 6ac3f774-d9fb… &lt;NA&gt;         Animal… Chord… Mamm… Prob… Eleph… Loxo…
 8 922237188 6ac3f774-d9fb… &lt;NA&gt;         Animal… Chord… Mamm… Prob… Eleph… Loxo…
 9 922237135 6ac3f774-d9fb… &lt;NA&gt;         Animal… Chord… Mamm… Prob… Eleph… Loxo…
10 922237121 6ac3f774-d9fb… &lt;NA&gt;         Animal… Chord… Mamm… Prob… Eleph… Loxo…
# ℹ 12,527 more rows
# ℹ 41 more variables: species &lt;chr&gt;, infraspecificEpithet &lt;chr&gt;,
#   taxonRank &lt;chr&gt;, scientificName &lt;chr&gt;, verbatimScientificName &lt;chr&gt;,
#   verbatimScientificNameAuthorship &lt;chr&gt;, countryCode &lt;chr&gt;, locality &lt;chr&gt;,
#   stateProvince &lt;chr&gt;, occurrenceStatus &lt;chr&gt;, individualCount &lt;dbl&gt;,
#   publishingOrgKey &lt;chr&gt;, decimalLatitude &lt;dbl&gt;, decimalLongitude &lt;dbl&gt;,
#   coordinateUncertaintyInMeters &lt;dbl&gt;, coordinatePrecision &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="regional-node-via-galah" class="level4" data-number="3.3.2.2">
<h4 data-number="3.3.2.2" class="anchored" data-anchor-id="regional-node-via-galah"><span class="header-section-number">3.3.2.2</span> Regional node via <code>galah</code></h4>
<p>In order to access data from the Australia node, we will need to reconfigure <code>galah</code> so that our query points to Australia. After that, we will download all records for the Pink Robin.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">galah_config</span>(<span class="at">email =</span> <span class="fu">Sys.getenv</span>(<span class="st">"ALA_EMAIL"</span>), </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">atlas =</span> <span class="st">"Australia"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>pink_robin <span class="ot">&lt;-</span> <span class="fu">galah_call</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">galah_identify</span>(<span class="st">"Petroica rodinogaster"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  atlas_occurrences</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,992 × 8
   decimalLatitude decimalLongitude eventDate           scientificName          
 *           &lt;dbl&gt;            &lt;dbl&gt; &lt;dttm&gt;              &lt;chr&gt;                   
 1           -43.7             146. NA                  Petroica (Erythrodryas)…
 2           -43.7             146. NA                  Petroica (Erythrodryas)…
 3           -43.7             146. 1971-02-03 14:00:00 Petroica (Erythrodryas)…
 4           -43.7             146. 2020-10-07 02:39:00 Petroica (Erythrodryas)…
 5           -43.7             146. 2015-09-22 14:00:00 Petroica (Erythrodryas)…
 6           -43.6             146. 2002-01-03 13:00:00 Petroica (Erythrodryas)…
 7           -43.6             146. NA                  Petroica (Erythrodryas)…
 8           -43.6             146. 2020-12-27 13:00:00 Petroica (Erythrodryas)…
 9           -43.6             146. 2021-03-07 13:00:00 Petroica (Erythrodryas)…
10           -43.6             146. 2020-12-26 13:00:00 Petroica (Erythrodryas)…
# ℹ 11,982 more rows
# ℹ 4 more variables: taxonConceptID &lt;chr&gt;, recordID &lt;chr&gt;,
#   dataResourceName &lt;chr&gt;, occurrenceStatus &lt;chr&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="spatial-focus" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="spatial-focus"><span class="header-section-number">3.3.3</span> Spatial focus</h3>
<!-- Work in progess -->
<!-- Narrowing your results to a specific spatial area- using `galah_geolocate` or by regions etc, discussions around whether this is best to be placed in this chapter to assist with expaning scope has been raised.  -->
<!-- Read in shpfile, transform to polygon -->
</section>
</section>
<section id="choosing-specific-data-columns" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="choosing-specific-data-columns"><span class="header-section-number">3.4</span> Choosing specific data columns</h2>
<p>By default, <code>atlas_occurrences</code> will return a tibble with a selection of columns containing taxonomic and spatial data as well as other metadata. Alternatively, you can use <code>galah_select</code> to subset the columns that are relevant for your work. To see all available fields you can choose from:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_all</span>(fields) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 611 × 4
   id                    description                                 type  link 
   &lt;chr&gt;                 &lt;chr&gt;                                       &lt;chr&gt; &lt;chr&gt;
 1 abcdTypeStatus        ABCD field in use by herbaria               fiel… &lt;NA&gt; 
 2 acceptedNameUsage     http://rs.tdwg.org/dwc/terms/acceptedNameU… fiel… &lt;NA&gt; 
 3 acceptedNameUsageID   http://rs.tdwg.org/dwc/terms/acceptedNameU… fiel… &lt;NA&gt; 
 4 accessRights          &lt;NA&gt;                                        fiel… &lt;NA&gt; 
 5 assertionUserId       User ID of the person who has made an asse… fiel… &lt;NA&gt; 
 6 assertions            A list of all assertions (user and system … fiel… &lt;NA&gt; 
 7 associatedMedia       http://rs.tdwg.org/dwc/terms/associatedMed… fiel… &lt;NA&gt; 
 8 associatedOccurrences http://rs.tdwg.org/dwc/terms/associatedOcc… fiel… &lt;NA&gt; 
 9 associatedOrganisms   http://rs.tdwg.org/dwc/terms/associatedOrg… fiel… &lt;NA&gt; 
10 associatedReferences  http://rs.tdwg.org/dwc/terms/associatedRef… fiel… &lt;NA&gt; 
# ℹ 601 more rows</code></pre>
</div>
</div>
<p>Here, we will choose a smaller subsets of 8 columns to download for the Pink Robin</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>project_fields <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"recordID"</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"eventDate"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"year"</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"basisOfRecord"</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"occurrenceStatus"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"scientificName"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"decimalLatitude"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"decimalLongitude"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>pink_robin_projfields <span class="ot">&lt;-</span> <span class="fu">galah_call</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">galah_identify</span>(<span class="st">"Petroica rodinogaster"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">galah_select</span>(project_fields) <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">atlas_occurrences</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,992 × 8
   recordID             eventDate            year basisOfRecord occurrenceStatus
 * &lt;chr&gt;                &lt;dttm&gt;              &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;           
 1 000fc2ef-b696-4576-… 1976-12-18 13:00:00  1976 HUMAN_OBSERV… PRESENT         
 2 001410fd-3a01-43aa-… 1978-05-23 14:00:00  1978 HUMAN_OBSERV… PRESENT         
 3 00164a76-0b3a-4b44-… 1977-12-15 13:00:00  1977 HUMAN_OBSERV… PRESENT         
 4 001bfca5-4197-40a6-… 1940-12-31 14:00:00  1941 OBSERVATION   PRESENT         
 5 001e33bd-bb15-4384-… 2002-10-17 14:00:00  2002 HUMAN_OBSERV… PRESENT         
 6 0021cc7c-a371-4af6-… 2016-04-09 14:00:00  2016 OCCURRENCE    PRESENT         
 7 00287e24-87b8-429a-… 2021-01-14 13:00:00  2021 HUMAN_OBSERV… PRESENT         
 8 002e05a7-b1bf-4eba-… 2000-07-24 14:00:00  2000 OBSERVATION   PRESENT         
 9 00327fc2-ae67-467b-… 1983-11-23 13:00:00  1983 PRESERVED_SP… PRESENT         
10 0035016f-ae80-494a-… NA                     NA HUMAN_OBSERV… PRESENT         
# ℹ 11,982 more rows
# ℹ 3 more variables: scientificName &lt;chr&gt;, decimalLatitude &lt;dbl&gt;,
#   decimalLongitude &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="refining-your-data-download" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="refining-your-data-download"><span class="header-section-number">3.5</span> Refining your data download</h2>
<p>Open access biodiversity data comes from many different providers such as universities, research institutes (museums and herbariums), government and the general public. As such, data type and quality can vary considerably. For example, museums harbour older records that are associated with a preserved specimen, whereas citizen sourced data are often images captured from a smart phone.</p>
<p>Refining your download query ensures higher quality data and also reduces the download size as many data infrastructures impose constraints to download size. Below we have illustrated how you can refine your query a few quality measures using <code>galah_filter</code>.</p>
<section id="by-year" class="level4" data-number="3.5.0.1">
<h4 data-number="3.5.0.1" class="anchored" data-anchor-id="by-year"><span class="header-section-number">3.5.0.1</span> By Year</h4>
<p>Generally, old data records tend to be insufficient or less reliable as taxonomic knowledge and GPS tools were not readily available. For this reason, many users consider removing all occurrence records before a certain year to increase data precision <span class="citation" data-cites="gueta_quantifying_2016 marsh_accounting_2022">(<a href="references.html#ref-gueta_quantifying_2016" role="doc-biblioref">Gueta and Carmel 2016</a>; <a href="references.html#ref-marsh_accounting_2022" role="doc-biblioref">Marsh et al. 2022</a>)</span> .</p>
<p>Choosing the year ‘cut-off’ is relatively arbitary, but the most commonly used year is 1945 <span class="citation" data-cites="zizka_no_2020 fuhrding-potschkat_influence_2022">(<a href="references.html#ref-zizka_no_2020" role="doc-biblioref">Zizka et al. 2020</a>; <a href="references.html#ref-fuhrding-potschkat_influence_2022" role="doc-biblioref">Führding-Potschkat, Kreft, and Ickert-Bond 2022</a>)</span>, although some studies discard all data collected before 1990 <span class="citation" data-cites="gueta_quantifying_2016 marsh_accounting_2022">(<a href="references.html#ref-gueta_quantifying_2016" role="doc-biblioref">Gueta and Carmel 2016</a>; <a href="references.html#ref-marsh_accounting_2022" role="doc-biblioref">Marsh et al. 2022</a>)</span>.</p>
<p>Here we will narrow the Pink Robin query from above to records after 1945 using <code>galah_filter</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pink_robin_post1945 <span class="ot">&lt;-</span> <span class="fu">galah_call</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">galah_identify</span>(<span class="st">"Petroica rodinogaster"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">galah_filter</span>(year <span class="sc">&gt;</span> <span class="dv">1945</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">atlas_occurrences</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="basis-of-record" class="level4" data-number="3.5.0.2">
<h4 data-number="3.5.0.2" class="anchored" data-anchor-id="basis-of-record"><span class="header-section-number">3.5.0.2</span> Basis of record</h4>
<p>Basis of record is a <a href="https://dwc.tdwg.org/terms/#dwc:basisOfRecord">Darwin Core term</a> that refers to the specific nature of the occurrence record. It can be used to refine your data download and ensure consistency when consolidating data from multiple organisations <span class="citation" data-cites="fuhrding-potschkat_influence_2022">(<a href="references.html#ref-fuhrding-potschkat_influence_2022" role="doc-biblioref">Führding-Potschkat, Kreft, and Ickert-Bond 2022</a>)</span>.</p>
<p>There are 6 different classes for basis of record:</p>
<ul>
<li>Living Specimen - a specimen that is alive, e.g.&nbsp;a living plant in a national park</li>
<li>Preserved Specimen - a specimen that has been preserved, for example, a dried plant on an herbarium sheet</li>
<li>Fossil Specimen - a preserved specimen that is a fossil</li>
<li>Material Sample - a genetic or environmental sample</li>
<li>Material Citation - A reference to, or citation of, a specimen in scholarly publications, e.g a citation of a physical specimen in a scientific journal</li>
<li>Human Observation - an output of human observation process e.g.&nbsp;evidence of an occurrence taken from field notes or an occurrence without any physical evidence</li>
<li>Machine Observation - An output of a machine observation process e.g.&nbsp;a photograph, a video, an audio recording, a remote sensing image or an occurrence record based on telemetry.</li>
</ul>
<p>Depending on your data scope, it may be practical to limit data that can be traced to a physical specimen or observation <span class="citation" data-cites="godfree_implications_2021">(<a href="references.html#ref-godfree_implications_2021" role="doc-biblioref">Godfree et al. 2021</a>)</span>, which we do for the Pink Robin below</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>tractable_records <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"LIVING_SPECIMEN"</span>, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"PRESERVED_SPECIMEN"</span>, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"MATERIAL_SAMPLE"</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"MACHINE_OBSERVATION"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>pink_robin_tractable <span class="ot">&lt;-</span> <span class="fu">galah_call</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">galah_identify</span>(<span class="st">"Petroica rodinogaster"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">galah_filter</span>(basisOfRecord <span class="sc">==</span> tractable_records) <span class="sc">%&gt;%</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">atlas_occurrences</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assertions" class="level4" data-number="3.5.0.3">
<h4 data-number="3.5.0.3" class="anchored" data-anchor-id="assertions"><span class="header-section-number">3.5.0.3</span> Assertions</h4>
<p>Data infrastructures use assertions to internally grade the quality, completeness and consistency of each occurrence record. Assertions take values of either 1 or 0, indicating the presence or absence of the data quality issue. Note that assertions may vary depending what atlas you have configured to. You can see the available assertions and their descriptions using:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_all</span>(<span class="st">"assertions"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 117 × 4
   id                                 description                 category type 
   &lt;chr&gt;                              &lt;chr&gt;                       &lt;chr&gt;    &lt;chr&gt;
 1 AMBIGUOUS_COLLECTION               Ambiguous collection        Warning  asse…
 2 AMBIGUOUS_INSTITUTION              Ambiguous institution       Warning  asse…
 3 BASIS_OF_RECORD_INVALID            Basis of record badly form… Warning  asse…
 4 biosecurityIssue                   Biosecurity issue           Error    asse…
 5 COLLECTION_MATCH_FUZZY             Collection match fuzzy      Warning  asse…
 6 COLLECTION_MATCH_NONE              Collection not matched      Warning  asse…
 7 CONTINENT_COUNTRY_MISMATCH         Continent country mismatch  Warning  asse…
 8 CONTINENT_DERIVED_FROM_COORDINATES Continent derived from coo… Warning  asse…
 9 CONTINENT_INVALID                  Continent invalid           Warning  asse…
10 COORDINATE_ACCURACY_INVALID        Coordinate accuracy invalid Warning  asse…
# ℹ 107 more rows</code></pre>
</div>
</div>
<p>Once you have decided which assertions are important for your project you can further refine your download. To retrieve all the assertions for your query use <code>galah_select(group = "assertions")</code></p>
<!-- Explain:  -->
<!-- Assertions are logical flags, TRUE is presence of issue denoted in column name -->
<!-- User to choose which ones are relevant to their project and filter in query -->
<!-- For exclusions using multiple assertions (Currently throws errors, need to think carefully about != means for logical assertions...) -->


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-fuhrding-potschkat_influence_2022" class="csl-entry" role="listitem">
Führding-Potschkat, Petra, Holger Kreft, and Stefanie M. Ickert-Bond. 2022. <span>“Influence of Different Data Cleaning Solutions of Point-Occurrence Records on Downstream Macroecological Diversity Models.”</span> <em>Ecology and Evolution</em> 12 (8): e9168. <a href="https://doi.org/10.1002/ece3.9168">https://doi.org/10.1002/ece3.9168</a>.
</div>
<div id="ref-godfree_implications_2021" class="csl-entry" role="listitem">
Godfree, Robert C., Nunzio Knerr, Francisco Encinas-Viso, David Albrecht, David Bush, D. Christine Cargill, Mark Clements, et al. 2021. <span>“Implications of the 2019–2020 Megafires for the Biogeography and Conservation of <span>Australian</span> Vegetation.”</span> <em>Nature Communications</em> 12 (1): 1023. <a href="https://doi.org/10.1038/s41467-021-21266-5">https://doi.org/10.1038/s41467-021-21266-5</a>.
</div>
<div id="ref-gueta_quantifying_2016" class="csl-entry" role="listitem">
Gueta, Tomer, and Yohay Carmel. 2016. <span>“Quantifying the Value of User-Level Data Cleaning for Big Data: <span>A</span> Case Study Using Mammal Distribution Models.”</span> <em>Ecological Informatics</em> 34 (July): 139–45. <a href="https://doi.org/10.1016/j.ecoinf.2016.06.001">https://doi.org/10.1016/j.ecoinf.2016.06.001</a>.
</div>
<div id="ref-marsh_accounting_2022" class="csl-entry" role="listitem">
Marsh, Jessica R., Payal Bal, Hannah Fraser, Kate Umbers, Tanya Latty, Aaron Greenville, Libby Rumpff, and John C. Z. Woinarski. 2022. <span>“Accounting for the Neglected: <span>Invertebrate</span> Species and the 2019–2020 <span>Australian</span> Megafires.”</span> <em>Global Ecology and Biogeography</em> n/a (n/a). <a href="https://doi.org/10.1111/geb.13550">https://doi.org/10.1111/geb.13550</a>.
</div>
<div id="ref-zizka_no_2020" class="csl-entry" role="listitem">
Zizka, Alexander, Fernanda Antunes Carvalho, Alice Calvente, Mabel Rocio Baez-Lizarazo, Andressa Cabral, Jéssica Fernanda Ramos Coelho, Matheus Colli-Silva, Mariana Ramos Fantinati, Moabe F Fernandes, and Thais Ferreira-Araújo. 2020. <span>“No One-Size-Fits-All Solution to Clean <span>GBIF</span>.”</span> <em>PeerJ</em> 8: e9916.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./scope.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data scope</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./preclean.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Precleaning</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Data Cleaning booklet is a product of the Atlas of Living Australia.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>