{
  "hash": "13102187872a85ccc1f91cd8b5811a11",
  "result": {
    "markdown": "---\nbibliography: references.bib\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\n# Download occurrence data {#sec-download-data}\n\nOnce you have decided on your data scope, we can precede to downloading the data. We will introduce a few common data infrastructures that offer open access biodiversity data and highlight some considerations when choosing one in the context of your data scope. We will then discuss some obstacles when consolidating data from multiple sources and the importance of metadata.\n\n## Where to get data from\n\nThe [Global Biodiversity Information Facility (GBIF)](https://www.gbif.org/) network consists of a series of 'node' organisations who collate biodiversity data from their own countries, with GBIF acting as an overarching organisation to store data from all nodes. Users that are interested in obtaining data that has global coverage may want to download directly from GBIF.\n\nAlternatively, using a *regional node* may be more relevant if your project is at a smaller scale. For example, the [Atlas of Living Australia (ALA)](www.ala.org.au) is the Australian node to GBIF and aggregates data from a broad range of providers such as government initiatives, museums, and universities. Importantly, the ALA uses their own taxonomic system and may vary with other data infrastructures. To find other nodes, check out this [page](https://www.gbif.org/the-gbif-network)\n\nIf your project relates to citizen science then [iNaturalist](https://www.inaturalist.org/) may be a good option for accessing crowd-sourced data of species observations.\n\n## Downloading data\n\nMany developers have created R packages to interact with each data infrastructures's API to aid access to biodiversity data. Here are a few examples, we recommend taking a look at each package's documentation to choose one that suits your project.\n\n-   [`rgbif`](https://docs.ropensci.org/rgbif/) an interface to GBIF\n-   [`galah`](https://galah.ala.org.au/index.html) an interface to a number living Atlases, as well as GBIF\n-   [`rinat`](https://docs.ropensci.org/rinat/) an interface to iNaturalist observations\n-   [`rebird`](https://docs.ropensci.org/rebird/) an interface with the eBird webservices.\n-   [`spocc`](https://docs.ropensci.org/spocc/) a R package to query and collect species occurrence data from various sources including [VertNet](https://github.com/ropensci/rvertnet), [iDigBio](http://www.idigbio.org/) and others.\n\nOne benefit of using `galah` is that enables users to acquire not only species occurrence records but also taxonomic information, or associated media such as images or sounds. Below we have included some code blocks for downloading occurrence data with `galah` from GBIF and a Spain node.\n\n### GBIF data via `galah`\n\nFirst, we have to configure `galah`. This is where you supply your account credentials and set the atlas to a particular region. See `?galah_config` for more configuration options. You can [save these credentials](https://docs.ropensci.org/rgbif/articles/gbif_credentials.html) in your `.Renviron` so you don't have to enter it explicitly in code.\n\nWe will be downloading all occurrences for the African Elephant from GBIF. This may take a while as it is around 12,000 records. Once downloaded, you can save the records locally in your desired format. For larger downloads, we recommend saving the data as `parquets` using `arrow::write_parquet`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngalah_config(email = Sys.getenv(\"ALA_EMAIL\"),\n             username = Sys.getenv(\"GBIF_USER\"),\n             password = Sys.getenv(\"GBIF_PWD\"),\n             atlas = \"Global\")\n\nafrican_ele <- galah_call() %>% \n  galah_identify(\"Loxodonta africana\") %>% \n  atlas_occurrences()\n\narrow::write_parquet(african_ele, \"data/gbif/elephant\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 12,537 × 50\n      gbifID datasetKey  occur…¹ kingdom phylum class order family genus species\n *     <dbl> <chr>       <chr>   <chr>   <chr>  <chr> <chr> <chr>  <chr> <chr>  \n 1 924537719 95f132fe-f… 73e088… Animal… Chord… Mamm… Prob… Eleph… Loxo… Loxodo…\n 2 924537718 95f132fe-f… 73e0ad… Animal… Chord… Mamm… Prob… Eleph… Loxo… Loxodo…\n 3 924537717 95f132fe-f… 73f0f6… Animal… Chord… Mamm… Prob… Eleph… Loxo… Loxodo…\n 4 923926679 50c9509d-2… http:/… Animal… Chord… Mamm… Prob… Eleph… Loxo… Loxodo…\n 5 923924124 50c9509d-2… http:/… Animal… Chord… Mamm… Prob… Eleph… Loxo… Loxodo…\n 6 922237429 6ac3f774-d… <NA>    Animal… Chord… Mamm… Prob… Eleph… Loxo… Loxodo…\n 7 922237412 6ac3f774-d… <NA>    Animal… Chord… Mamm… Prob… Eleph… Loxo… Loxodo…\n 8 922237188 6ac3f774-d… <NA>    Animal… Chord… Mamm… Prob… Eleph… Loxo… Loxodo…\n 9 922237135 6ac3f774-d… <NA>    Animal… Chord… Mamm… Prob… Eleph… Loxo… Loxodo…\n10 922237121 6ac3f774-d… <NA>    Animal… Chord… Mamm… Prob… Eleph… Loxo… Loxodo…\n# … with 12,527 more rows, 40 more variables: infraspecificEpithet <chr>,\n#   taxonRank <chr>, scientificName <chr>, verbatimScientificName <chr>,\n#   verbatimScientificNameAuthorship <chr>, countryCode <chr>, locality <chr>,\n#   stateProvince <chr>, occurrenceStatus <chr>, individualCount <dbl>,\n#   publishingOrgKey <chr>, decimalLatitude <dbl>, decimalLongitude <dbl>,\n#   coordinateUncertaintyInMeters <dbl>, coordinatePrecision <dbl>,\n#   elevation <dbl>, elevationAccuracy <dbl>, depth <dbl>, …\n```\n:::\n:::\n\n\nBy default, `atlas_occurrences` will return a tibble with a number of columns containing taxonomic and spatialinformation as well as other metadata. You can use `galah_select` to select the columns that are relevant for you. To see all available fields you can choose from:\n\n\n::: {.cell}\n\n:::\n\n\n### Regional node via `galah`\n\nIn order to access data from the Australia node, we will need to reconfigure `galah` so that our query points to Australia. After that, we will download all records for the Pink Robin.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngalah_config(email = Sys.getenv(\"ALA_EMAIL\"), \n             atlas = \"Australia\")\n\npink_robin <- galah_call() %>% \n  galah_identify(\"Petroica rodinogaster\") %>% \n  atlas_occurrences\n\narrow::write_parquet(pink_robin, \"data/galah/pink_robin\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 11,992 × 8\n   decimal…¹ decim…² eventDate           scien…³ taxon…⁴ recor…⁵ dataR…⁶ occur…⁷\n *     <dbl>   <dbl> <dttm>              <chr>   <chr>   <chr>   <chr>   <chr>  \n 1     -43.7    146. NA                  Petroi… https:… 81d100… Histor… PRESENT\n 2     -43.7    146. NA                  Petroi… https:… 235009… Histor… PRESENT\n 3     -43.7    146. 1971-02-03 14:00:00 Petroi… https:… 0f644c… Histor… PRESENT\n 4     -43.7    146. 2020-10-07 02:39:00 Petroi… https:… 77d610… iNatur… PRESENT\n 5     -43.7    146. 2015-09-22 14:00:00 Petroi… https:… e92acb… eBird … PRESENT\n 6     -43.6    146. 2002-01-03 13:00:00 Petroi… https:… 1a4ac6… BirdLi… PRESENT\n 7     -43.6    146. NA                  Petroi… https:… 28ec00… Histor… PRESENT\n 8     -43.6    146. 2020-12-27 13:00:00 Petroi… https:… cbc68d… eBird … PRESENT\n 9     -43.6    146. 2020-12-14 13:00:00 Petroi… https:… 56567e… eBird … PRESENT\n10     -43.6    146. 2020-12-23 13:00:00 Petroi… https:… 3b4d1f… eBird … PRESENT\n# … with 11,982 more rows, and abbreviated variable names ¹​decimalLatitude,\n#   ²​decimalLongitude, ³​scientificName, ⁴​taxonConceptID, ⁵​recordID,\n#   ⁶​dataResourceName, ⁷​occurrenceStatus\n```\n:::\n:::\n\n\n## Refining your data download\n\nOpen access biodiversity data comes from many different providers such as universities, research institutes (museums and herbariums), government and the general public. As such, the data type and quality can vary considerably. For example, museums harbour older records that are associated with a preserved specimen, whereas citizen sourced data are often images captured from a smart phone.\n\nRefining your download query ensures higher quality data and also reduces the download size as many data infrastructures impose constraints to download size. Below we have illustrated how you can refine your query a few quality measures using `galah_filter`.\n\n#### By Year\n\nGenerally, old data records tend to be insufficient or less reliable as taxonomic knowledge and GPS tools were not readily available. For this reason, many users consider removing all occurrence records before a certain year to increase data precision [@gueta_quantifying_2016; @marsh_accounting_2022] .\n\nChoosing the year 'cut-off' is relatively arbitary, but the most commonly used year is 1945 [@zizka_no_2020; @fuhrding-potschkat_influence_2022], although some studies discard all data collected before 1990 [@gueta_quantifying_2016; @marsh_accounting_2022].\n\nHere we will narrow the Pink Robin query from above to records after 1945 using `galah_filter`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npink_robin_post1945 <- galah_call() %>% \n  galah_identify(\"Petroica rodinogaster\") %>% \n  galah_filter(year > 1945) %>% \n  atlas_occurrences()\n```\n:::\n\n\n#### Basis of record\n\nBasis of record is a [Darwin Core term](https://dwc.tdwg.org/terms/#dwc:basisOfRecord) that refers to the specific nature of the occurrence record. It can be used to refine your data download and ensure consistency when consolidating data from multiple organisations [@fuhrding-potschkat_influence_2022].\n\nThere are 6 different classes for basis of record:\n\n-   Living Specimen - a specimen that is alive, e.g. a living plant in a national park\n-   Preserved Specimen - a specimen that has been preserved, for example, a dried plant on an herbarium sheet\n-   Fossil Specimen - a preserved specimen that is a fossil\n-   Material Sample - a genetic or environmental sample\n-   Material Citation - A reference to, or citation of, a specimen in scholarly publications, e.g a citation of a physical specimen in a scientific journal\n-   Human Observation - an output of human observation process e.g. evidence of an occurrence taken from field notes or an occurrence without any physical evidence\n-   Machine Observation - An output of a machine observation process e.g. a photograph, a video, an audio recording, a remote sensing image or an occurrence record based on telemetry.\n\nDepending on your data scope, it may be practical to limit data that can be traced to a physical specimen or observation [@godfree_implications_2021], which we do for the Pink Robin below\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntractable_records <- c(\"LIVING_SPECIMEN\", \n                       \"PRESERVED_SPECIMEN\", \n                       \"MATERIAL_SAMPLE\", \n                       \"MACHINE_OBSERVATION\")\n\npink_robin_tractable <- galah_call() %>% \n  galah_identify(\"Petroica rodinogaster\") %>% \n  galah_filter(basisOfRecord == tractable_records) %>% \n  atlas_occurrences()\n```\n:::\n\n\n#### Assertions\n\nData infrastructures use assertions to internally grade the quality, completeness and consistency of each occurrence record. Assertions take values of either 1 or 0, indicating the presence or absence of the data quality issue. Note that assertions may vary depending what atlas you have configured to. You can see the available assertions and their descriptions using:\n\n\n::: {.cell}\n\n:::\n\n\nOnce you have decided which assertions are important for your project you can further refine your download\n\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}